<plain_text><page sequence="1">2003-01-2229 Data-Based Motion Prediction Julian J. Faraway University of Michigan Copyright © 2003 SAE International ABSTRACT A complete scheme for motion prediction based on mo- tion capture data is presented. The scheme rests on three main components: a special posture representation, a di- verse motion capture database and prediction method. Most prior motion prediction schemes have been based on posture representations based on well-known local or global angles. Difficulties have arisen when trying to sat- isfy constraints, such as placing a hand on a target or scaling the posture for a subject of different stature. In- verse kinematic methods based on such angles require optimization that become increasingly complex and com- putationally intensive for longer linkages. A different rep- resentation called stretch pivot coordinates is presented that avoids these difficulties. The representation allows for easy rescaling for stature and other linkage length varia- tions and satisfaction of endpoint constraints, all without optimization allowing for rapid real time use. The validity of this scheme also rests on the availability of motion capture data. There are two situations - in one case the user has access to a larger database of mo- tions relevant to the particular problem while in the second case, the user collects a small amount of motion capture data concerning the task of interest. At the Human Mo- tion Simulation Laboratory (HuMoSim) at the University of Michigan, we have collected several large databases on various types of automobile and materials handling mo- tions. A prediction models based on these databases is presented. Two contrasting prediction methods are demonstrated. One is parametric and uses functional regression analysis to predict the stretch pivot coordinates used in the postu- ral representation as they vary over the time of the mo- tion. This regression-type model allows the use of subject- based variables such as stature and age and task based variables such as target location and object weight to in- fluence the predicted motion. This also allows the scien- tific study of the effect of such factors using statistical sig- nificance testing. The second type of prediction method is based on the idea of nearest neighbor nonparametric regression. A small number (perhaps even just one) of motions is selected that have characteristics similar to the motion we wish to predict. These motions are then aver- aged in a special way using the stretch pivot coordinates to produce the predicted motion with the required features such as stature, target location etc. This method lends itself to the prediction of motion based on small special purpose motion capture databases collected by the user for some specific problem. Keywords: Ergonomics, Motion Warping, Trajectory Mod- eling, Inverse Kinematics. INTRODUCTION Accurate predictions of human motion are valuable in many industrial applications. See [3] for a discussion of the utility of models for motion prediction. Many vehicle interiors and workplaces are first designed using a CAD system. Physical prototypes are useful for evaluating the ergonomie characteristics of the design, but these are ex- pensive and time consuming especially when a design must proceed through several iterations. The ability to place an authentically moving virtual human within soft- ware such as Jack ([2]) helps the designer detect prob- lems with the layout that can be rapidly corrected, thus speeding the design process. In some other applications, it is sufficient to produce motions that appear to be cor- rect, but this application demands that the predicted mo- tions be close to how people really move. Such demands impose greater costs in terms of the quantity of motion capture data required. Even so, the methodology pre- 722</page><page sequence="2">sented below is generalizable and would be useful across a wide range of applications. There Is a huge amount of research on human motion. Some predictive models for human motion rely heavily on theories of human physiology and psychology. For ex- ample, see recent presentations at Digital Human Model- ing Conferences, [10] and [1], However, in recent years, motion capture technology has allowed us to collect large databases of human motion that make the construction of empirical models of motion feasible. The type of models we present here use relatively little knowledge of biome- chanics, but rely on observations of real people from which they draw their validity. In animation applications, when a particular motion is re- quired, a common approach is to employ an actor to perform the desired motion, recording the trajectories of markers attached to the body. The motion is then mapped onto the animated character. Sometimes, the motion needs to be edited because the animated character has a different anthropometry than the actor or the motion needs to be retargetted, for example, a hand needs to reach to a somewhat different location. Techniques exist for doing this - for example see [21] who describe mo- tion warping or retargeting, see [9], or motion editing, see [14], See also [20]. It is expensive and impractical in many applications to em- ploy an actor every time a new motion is needed. Instead one might assemble a database of motions that could be used to predict new motions when they are needed. In the example presented below, one wishes to predict how a worker will move a box to a shelf - one wants to know the positions of all parts of the body as the motion oc- curs. We collected a database of people moving boxes to shelves at a range of locations. We used this data to construct a model that takes the anthropometry and other features of the subject along with the desired position of the shelf as inputs and outputs the predicted motion. One of these models uses the notion of local averaging. The motions selected in the database, that are most similar to the one we want to predict, are then averaged to make the prediction. The advantage of averaging several mo- tions compared to just a single motion is that the effect of individual variability is reduced and the user can be sure that a more typical motion is being viewed. Of course, the individual variability is still interesting and can be modeled - see [7]. An alternative to local averaging of motions is to regress the motion on the inputs. In this manner, all motions rela- tively similar to the desired motion can contribute informa- tion to the prediction according to the closeness of their inputs. This functional regression style of modeling is ex- plained below. The difficult part of this is to construct an appropriate method for averaging that satisfies constraints such as the fixed segment lengths of the human frame or placing the box exactly on the shelf. In the sections below, the heart of the problem, the methodology and an application are described and a comparison to existing methods is made. DATA In this section, the data to which the methods were ap- plied is described. The methodology presented here could be applied to data collected in different ways for dif- ferent linkages, so this data serves as an example and not a boundary to what can be achieved. In 1999, the Human Motion Simulation Laboratory (HU- MOSIM) at the University of Michigan conducted a set of experiments concentrated on the motions of standing people performing reaches to a dispersed set of targets. In one experiment, subjects were required to move a small box with both hands from a position in front of the body at waist height to a shelf at the specified target. The subject then released the box and returned to the rest position, then reached back to the box, grasped it and returned it to the rest position. The left foot was held fixed, but the rest of the body was free to move. A total of about 3000 motions were performed by a group of 20 subjects reaching to 30 targets where the four parts of the motion described above are counted separately. The subjects were selected to provide a means to assess the effects of anthropometry (height in particular), gender, and age on the motions. The subjects ranged from very short to very tall and from 20 to 60 years of age. Two dif- ferent motion capture systems were simultaneously used to estimate joint center locations throughout the motions: an optical reflective marker system and an electromag- netic one. The observed markers were external to the body but were projected to joint centers within the body. The whole posture was described by 23 joint center lo- cations located at the left and right feet, ankles, knees, hips, shoulders, elbows, wrist, front and back of hand to- gether with the L5/S1 (small of the back), the C7/T1 (back of the neck), the sternoclavicular joint (supersternale), the tragion (center of the head) and the nasion (between the eyes). The portions of the recorded motion where the subject was reaching were extracted based on the motion of the right hand. Because the data was collected at 20Hz and each motion lasted around 1 second on average, each motion was represented by the 3D coordinates of the 23 markers at around 20 timepoints on average. Due to oc- clusion or other data collection problems, some markers are missing during some parts of some motions. Where the amount of missing data was not substantial, the gaps were interpolated, otherwise the motion was discarded. INVERSE KINEMATICS AND THE STRETCH PIVOT Consider a chain of I jointed links in three dimensions as depicted in Figure 1 . Suppose that one end of the chain is fixed at the origin, that the joints have full flexibility and 723</page><page sequence="3">that the segments are of known lengths. One wishes to position the other end of the chain at some target T. For example, the chain might represent the arm and torso of a person who must reach to some target. The inverse kine- matics problem is to position the rest of the chain to satisfy this endpoint constraint. There is no unique solution and so the challenge is to select the "best" solution. ' Target Fixed Figure 1 : Inverse kinematics: Chain must be positioned to meet endpoint constraints Many authors have proposed different criteria by which the solutions should be judged - see for example, [22] or [11]. Measures of comfort, effort, stress, etc. have been developed. Finding such solutions involves optimization subject to non-linear constraints. Such problems can be difficult and time consuming to solve. Furthermore, it seems doubtful that any complex human behavior can be encapsulated by the optimization of any single criterion. Other approaches, like motion warping, are based on data showing a posture (or postures) similar to the desired one. The task is then to modify the observed posture as little as possible to meet the constraints of desired target and seg- ment lengths. This again involves a constrained optimiza- tion with the same practical problems with computation. The key advance in this paper is to present a parame- terization of the posture such that the constraints are al- ways implicitly satisfied. This allows for rapid and sim- ple computation of postures. We call this parameteri- zation, Stretch Pivot coordinates. Alternative approaches that model the posture using the joint coordinates or an- gles describing the orientation of the links of the chain, will require further conditions to meet the link length and endpoint constraints and thus cannot be conveniently av- eraged. The stretch pivot coordinates introduced here have the advantage that they can be averaged and still produce a valid configuration of the chain for any segment lengths and endpoints (provided the total segment length exceeds the distance between the endpoints). This allows the di- rect application of statistical methods. Only 21 - 3 parameters are necessary to describe a closed (i.e. endpoints fixed) /-link kinematic chain (two parame- ters for each segment minus three for the endpoint con- straint). The key to success is selecting these parameters in a suitable way. Consider first a closed 2-link chain in three dimensions, like the shoulder, elbow and wrist link- age, where the endpoints, the shoulder and wrist, are in fixed positions. Only one parameter is need to describe this linkage, since the midpoint (the elbow) of the chain is constrained to lie on a circle whose center lies on and is orthogonal to an axis joining the endpoints. One needs only to specify the angle on this circle. We call this mid- point the pivot and we call this angle the pivot angle. Such an angle was used by [13], [18] and [19]. The angle is il- lustrated in Figure 2. Pivot angle - -- -- -T-- ° J endpoint endpoint ' / ' / - midpoint must lie on this circle Figure 2: The pivot angle describes the location of the midpoint on the circle of its possible positions (3D view) Now consider an / link chain and pick a marker in the mid- dle of this chain. The selected marker does not need to be the middle in the sense of median, but assume, for now, that there are at least two links on each side of the selected marker. Let us arbitrarily call the two endpoint markers the proximal and the distal and the selected mid- point, the medial. Let lp and ld be the distances between the proximal and the medial and the distal and the me- dial respectively. If lp and ld are considered fixed, then the position of the medial relative to the proximal and dis- tal may be described in terms of a pivot angle, 0m lying on the circle orthogonal to, and whose center lies on, the axis joining the proximal and distal. Let mp and md respectively represent the total length of all the links joining the proximal and the medial and the distal and the medial. So 0 &lt; lp &lt; mp and 0 &lt; ld &lt; md Define pp = lp¡mp and pd = ld/md. We call the p' s the stretch parameters. The position of the medial may be described in terms of the three parameters {Qm,pP,Pd)- Hence the name stretch pivot. See Figure 3. Once the position of the pivot has been determined, the problem is reduced to two smaller problems. The same procedure may be repeated on the two halves of the chain recursively until the problem is reduced to a collection of two or three link chains. For the two link chains, only a pivot angle is needed to describe the middle marker. For a three link chain, the position of one of the midpoints may be described in terms of one pivot angle and one stretch parameter thereby reducing the problem to a two link chain requiring only one more pivot angle for descrip- tion. This parameterization uses exactly 21 - 3 parameters equal to the number of degrees of freedom in the chain. 724</page><page sequence="4">/ ' / medial ' • ' / ' distal proximal 'J * mpd * Figure 3: Stretch parameters illustrated. The distance be- tween the proximal and medial if that part of the chain were fully extended is mp while the corresponding dis- tance for the medial to the distal is md. We define pp = Ip/ntp and pa - Id/md . Depending on the particular configuration, further restric- tions will apply to the pair ( pp,Pd ) because the two halves of the chain must neither be too stretched or not stretched enough so that the halves might not join in the middle. Let mpd be the distance from the proximal to the distal. The triangle inequality and being proportions means that ( Pp,Pd ) must satisfy the following constraints: Pdmd + pPmp &gt; mpd Pdmd + mpd &gt; Ppmp mpd + Ppinp &gt; pdmd 0&lt;pp&lt;l 0 &lt; pd &lt; 1 Depending on the relative values of ( mp,md,mpd ), this re- sults in a range of potential values for ( pp,pd ) some of which are depicted in Figure 4. 2 j - i 7 - i - ^ j - i ; 1 - i ^ j - i ; p~~ q * o ' ' q ' s ' ' ' *"* , O f o // ó -t ' ' / ' &lt;0 " ' ' ' / &lt;0 - N / / (O ~ N ' / „ ö " N ' . „ ö - ' / / „ ® ~ N / / a ö - '' a 2 - a j _ ]o Ö s '' o - '' ' '' o - ' ^ /' H ^ 7*" ^ "'l í i r ) l' 3 "'l 'i Iv I I l' ^"*1 I 'l r I I 1 I -0.2 0.2 0.6 1.0 -0.2 0.2 0.6 1.0 -0.2 0.2 0.6 1.0 Pp Pp Pp Figure 4: Allowable range for ( pp,pd ) lies within the unit square further restricted by the triangle inequality con- straints shown as dotted lines. In all three panels, the proximal is at (0,0,0) and the distal is at (1 ,1,1). In the first panel, mp = 4 ,md = 4, in the second mp = 5,md = 4 and in the third mp = 6 ,md = 4. The points in all three plots are the values of ( pp,pd ) corresponding to four different values of (qs,qd): (0.1,0.9), (0.1,0.1), (0.9,0.1) and (0.9,0.9). One needs to model a bivariate response, ( pp,pd ), but the irregular shape of the domain being dependent on the relative values of ( mp,md,mpd ), makes it difficult to build a prediction equation that will always produce valid values. The following solution is proposed - work with ( Pp + Pd,Pd - Pp) where the first parameter measures how stretched out the configuration is while the second mea- sures the extent to which the midpoint is towards the prox- imal or distal. For any given ( mp,md,mpd ), one may determine the max- imum, qsmax, and the minimum, qsmin, values that can be taken by the sum, s = pp + Pd ■ We then define a new pa- rameter qs as qs = (^ qsmin) / (.q smax qsmin) So qs is a number between 0 and 1 representing the sum of the stretch parameters scaled within its allowable range. Now treating, s = pp + pd as fixed, we compute the range of the difference d = pd-pp as ( qdmin,qdmax ), and define qd as qd - (d qdmin) / isídmax d d min ) So qd is again a number between 0 and 1 representing the difference of the stretch parameters conditional on their sum, scaled within its allowable range. So any combina- tion of ( qs,qd ) within the unit square may be mapped to a (pP,Pd) for any (mp,md,mpd) combination. Importantly, the predicted configurations for a given (qs,qd) for different ( mp,md,mpd ) combinations will be roughly homologous in the sense of placing the medial in about the same location to the extent possible given the values of ( mp,md,mpd ). This feature is important if one is to use (qs, qd) as responses that can be sensibly aver- aged. The Values of qsmin^qsmax^qdmin^qdmax for given (lTlp , Hid ļ ïïlpd ) are given in the Appendix. The stretch parameters must lie between 0 and 1 so it is simpler to model log^r/(l - q) as the response so that the predicted q will always lie between 0 and 1 . There remains the problem of the three link chains which require only one stretch parameter to describe. Again the specific configuration of (mp,md,mpd) will determine the range of this stretch parameter which will be a subset of [0,1]. The problem is just a simpler version of the one solved above. One may compute the range of this stretch parameter and the compute an appropriate q e [0, 1] as above. In describing a pivot angle, two problems may occur. Firstly, when mp4-md = mpd, i.e. the two links are collinear, the angle cannot be defined at all. When this condition is close to occurring, there will be some instability in the pivot angle in that small changes in the midpoint may re- sult in large changes in the pivot angle. However, given that the ultimate aim is to predict the midpoint and not the pivot angle, this problem is not serious. The second problem lies in defining an origin for the pivot angle and is more troublesome. One way to define zero is to pick a direction, say the vertical, and project this di- rection onto the circle formed by the range of the pivot angle to define a zero. However, if the circle lies in the 725</page><page sequence="5">horizontal plane, the zero will be undefined. Of course, this is unlikely to occur exactly in practice, but more seri- ously, there will be much instability in the pivot angle when the motion is such that the axis joining proximal and dis- tal passes close to vertical. (Zero could also be defined using a plane, but the same problems will arise). Of course, one could just choose a different polar direc- tion but this will simply move the problem elsewhere. For some combinations of body markers, it is possible to pick a good polar direction since one might know that any axis that is likely to occur will not be close to the polar direc- tion. However, some combinations, such as the wrist, el- bow and shoulder, can clearly have axes in all directions. Some adaptive choice is necessary. The approach taken is to avoid this zero problem entirely by defining the angle in terms of the normal vector to the plane passing through the pivot and the two endpoints. The three coordinates of the normal vector are then mod- eled. Admittedly, three parameters are introduced where only one appears to be needed but the polar instabilities are avoided and the normal vector does contain relevant information about the orientation of the endpoints and the pivot which can be usefully modeled. MODELING DYNAMIC POSTURE We want to compute averages (and other statistics) of mo- tion and use these to make predictions of motion that sat- isfy endpoint constraints such as placing a box on a shelf for a subject of specified anthropometry. We have already shown how to model the interior joints of a chain. We now describe how to scale and represent these parameters as they change over time during a motion. We also present a parameterization of the motion of the endpoint conve- nient for modeling motion to and from specified targets. The complete posture will represented by a conjunction of chains as described later in the application section. TIME SCALING AND B-SPLINE REPRESENTATION Many individual components of the motion, such as an- gles between body segments as they change over time, can be described as functions. For example, consider an axis joining the initial and final location of the hand. We can compute the orthogonal distance of the hand from this axis during motion, which we will call the radial deviation. Because we observe the data only at discrete timepoints, we have a sequence of observed values from the start to the end of the motion. These sequences are of different lengths because some targets are further away than oth- ers and people reach at different speeds. We rescale all these motions so that t = 0 is the start of the motion and t = 1 is the end of the motion. We can save the actual time taken as a possible predictor of the motion and, perhaps, to be predicted itself. Plots of this distance for 20 subjects reaching with the right hand to a location somewhat to the left and front of the body and about the same height as the initial position of the hand are shown in Figure 5. Since there are 30 targets and some reaches were replicated, a plot of the complete data for this measure would show considerably more curves. It would be reasonable to average (or take averages of subsets of) the curves in Figure 5. Figure 5: The radial deviation of the hand from a straight line path when reaching with the right hand to a location on the left for 20 subjects For reasons of compactness and ease of manipulation, we represent the curves as linear combinations of m cu- bic B-spline basis functions, vļ/7(r). A curve y¡(t) is repre- sented as YJ='yij^j{t) where the coefficients _v,7 are esti- mated using least squares over the points at which y¡(t) is observed. Given that human motion is usually quite smooth, it is not necessary to have a large number of basis functions. In this particular application, we found that eight basis func- tions were sufficient. Any approximation error is dwarfed by the variation within and between individuals repeating the same motion so there is little value in using more basis functions. Using fewer basis functions is desirable espe- cially when motion databases may be large. So each ob- served curve is represented by eight coefficients and the functional response is thereby converted into a multivari- ate response which is easier to work with. A parametric approach to modeling such functions in terms of the pre- dictors may be found in [5]. TRAJECTORY REPRESENTATION In addition to pre- dicting univariate functions, such as the radial deviation, one needs to predict the 3D curves formed by the tra- jectory of the hand or other body markers. One could simply model each of the three Cartesian coordinates of the trajectory, but this is unsatisfactory as it is not invari- ant to rotations of the coordinate system which one may well wish to make. A different parameterization has been chosen that has more interpretable components and as- sumes that one has specified the beginning and end of the trajectory (as would be the case for predicting the move- 726</page><page sequence="6">ment of the hand for specified tasks). We define r(t) as the radial deviation at time t describ- ing the orthogonal distance from the axis joining the end- points, p{t) e [0, 1] as the proportionate progress along the axis at time t and v(t) = p'{t) as the relative axial veloc- ity. See the left panel of Figure 6 for a depiction of these quantities. Position ^ -~^End /'r(t) ' Start View down axis Figure 6: On the left, a side view of the reach is shown with the axis drawn as a straight line connecting the start and end of the reach. On the right, the view is down the axis, looking from the start towards the end. Let &lt;1&gt;(ř) be the angle describing the position of the hand at time t on the circle orthogonal to the axis of the reach and whose center lies on this axis. We define &lt;ļ&gt;(r) = 0 to be the projection of the unit vertical vector onto this circle. The trajectory is modeled using the triplet (v(í),r(í),(1&gt;(í))- Since v(0) = v(l) = r(0) = r(l) = 0 by definition, one can accommodate this by omitting the first and last cubic B- spline basis function in the representation which, since these are, respectively, the only non-zero basis functions at t = 0 and t = 1, will ensure the desired property. Fur- thermore, one should not directly model &lt;ļ)(r) because it is an angle. Angles 2k - e and e are only 2e apart but averaging their numerical values produces n which is di- ametrically opposite. For this reason, one models the responses cos&lt;ļ&gt;(r) and sin&lt;ļ&gt;(i) and then use the relation &lt;|) = tan-1(si'n&lt;ļ&gt;/cos&lt;ļ&gt;) to predict &lt;ļ) which does respect the appropriate continuity properties of an angle. Note that this representation contains no explicit infor- mation about the endpoints. This is convenient because when one predicts the hand motion one expects that the endpoints will specified by the requirements of the appli- cation. One can directly impose these endpoints and then use the representation to reconstruct the rest of the tra- jectory. A parametric approach to trajectory prediction may be found in [6]. So one is now able to describe the dynamic posture in terms of endpoint trajectories, pivot angles and trans- formed stretch parameters, which can each take any value within their allowable range independent of the value of any of the other parameters. This crucial prop- erty allows us to independently average each parameter. Given any predicted posture parameters, one can con- struct a motion for any choice of link lengths long enough to reach the target. MOTION WARPING OR RETARGETTING Suppose one observes a motion by one individual moving or reach- ing to some target and want to map it into a predicted motion for another individual moving or reaching to some other target. We describe the observed motion by (e,v(r),r(/),&lt;])(í),0(í),q(í),a(í)) where e represents the endpoint information such as where the hand should begin and end, v,r,(|&gt; represents the trajectory information 8,q represent the stretch pivot coordinates and a represents the unconstrained angular information (used to model the head motion - see later). All these elements have been written in bold to indicate that they may be vector quantities. For example, one may wish to model the trajectories of both hands indepen- dently. One may have more than one closed kinematic chain modeled by stretch pivot coordinates. There are a wealth of different possibilities that might be included within this framework. The individual for whom the mo- tion was collected also has set of segment lengths 1 or l(r) since some segment lengths (such as the torso) might be allowed to vary in time. Now consider a new individual with segment lengths 1' with specified endpoints e'. One may now take the v,r,(ļ),0,q,a from the original individual and use them to predict the motion for the new individual. Because of the properties of stretch pivot coordinates, one can be sure that such a motion will exist provided the segment lengths 1' of the new individual are sufficiently long to stretch between the required endpoints e'. The quality of the prediction will depend on how close e' is to e and how close 1' is to /. NEAREST NEIGHBOR METHODS There is no reason to restrict ourselves to using a sin- gle motion for constructing the prediction. Suppose one has motion data with various endpoints, segment lengths and other characteristics which are similar to the case one wishes to predict. One may average the stretch pivot and trajectory parameters describing these motions to con- struct the prediction. This prediction will tend to be supe- rior to the prediction based on a single motion for the usual reason that averages possess lower variances. One can consider more than just simple local averages - many of the well known ideas of nonparametric regression can be employed. See [16] for a review. There is also the question of which motions in a database should be considered comparable in the sense of having 727</page><page sequence="7">characteristics similar to those required for the prediction. For example, one may wish to predict the motion of a 48- year old, 50kg, 170cm tall woman of average strength lift- ing a box from specified shelf position. What character- istics should be used to judge similarity and how should they be combined? How many neighbors should be used or more generally how should the smoothing parameters be selected? Clearly there are a multitude of plausible schemes that could be used. Fortunately, one may eval- uate any candidate scheme with respect to its predictive ability using crossvalidation. We will describe how this was done in practice below. FUNCTIONAL REGRESSION ANALYSIS An alternative approach to simply averaging motions is to use regression modeling. The motions are described a collection of functions over time. These can be modeled using functional regression analysis. The potential advan- tage of this method over the nearest neighbor method is that it is possible to model the marginal contribution of subject factors such as age and gender in a transparent manner and test their statistical significance. Suppose the rescaled functions for some chosen quan- tity are given by y(t) = (y, ( t ), ...yn{t)) where the subscript runs over the n collected motions. These functions might be expected to depend on certain covariates such as the location of the target being reached, the age and anthro- pometry of the subject and other factors. For the i'h curve, these predictors are collected in a vector x¡. Typically, the first term in this vector is one. We then propose a func- tional linear model: y¡(t) = xfß(i) + e,(r) Notice that this is similar to a standard regression model but the response is now a function as is the error term £,(/). The regression coefficients ß(r) are now a vector of functions. A general introduction to the area of functional data analysis may be found in [15]. The particular co- efficient function for a given covariate will now represent the effect on the response of that covariate over the dura- tion of the reach. One can now estimate ß(r) using least squares by ß(r) = (XTX)-lXTy(t) where X is the matrix whose rows are given by the x,'s. This formula cannot be directly applied since one can- not observe a y,(r) at all possible t. One approach is to approximate the functions on a grid of values. This was done in [4]. A fine grid of values is necessary for accurate representation which is somewhat inefficient. So instead, the curves are represented as linear combinations of m cubic B-spline basis functions, 'ļ/y(/) . A curve y¡(t) is rep- resented as y,(t) « i y,j''ij(t) where the coefficients y,7 are estimated using least squares over the points at which y¡(t) is observed. Given that human motion is usually quite smooth, it is not necessary to have a large number of basis functions. In this particular application, one finds that eight basis func- tions were sufficient. So each observed curve is repre- sented by eight coefficients and the functional response is thereby converted into a multivariate response Thus the model can be written in the form Tixm^mx 1 (r) = XfixpB px 1 (r) "I" £/îx 1 (0 or factoring out the 'y(r), one can write it in the simpler form: Tixm - XnxpBpxm "F £«xm which is now a multivariate multiple regression model where the coefficient matrix B may be estimated using least squares: B=(XTX)~iXTY One may then use the standard methods of statistical in- ference using this modeling approach. Details of such methods may be found in texts such as [12]. For prediction and interpretation purposes, it is necessary to transform back from this basis function representation to the original form by ß/?xl(0 - ßpxm^mxl(0 One can predict future responses given a new predictor value xq by yo(0 - -*0l xpÉpxmtymx 1 (0 More details on this approach may be found in [5]. IMPLEMENTATION In this section, we describe the particular implementation used for modeling the data described above and how well the models performed. These choices would need to be reconsidered and recombined for other types of motion but it is worth describing the choices here to understand the considerations involved. We identified a chain stretching from the left foot to the right hand and containing 10 links. Other linkages branch off this chain. In this example, these would be the right leg, left arm and the head. The main linkage is modeled first. These secondary linkages are then modeled in a similar fashion once the main linkage has been predicted. See Figure 7. The selection of pivots is essential to the implementation of the stretch pivot coordinates. First consider the primary kinematic chain linking the left ball of foot to the right hand. The pivots selected were the c7/t1 , the left hip, the right shoulder, the right elbow and the left knee where the order indicates the order of precedence. The remaining mark- ers on this chain required only a pivot angle to describe. The right ball of foot was free to move in this experiment. We modeled the Cartesian coordinates (x(t),y(t),z(t)) di- rectly for this marker. Once the position of the right foot was determined, the right knee was used as a pivot with 728</page><page sequence="8">v Jb °7tl Jb 0 rshoul /sej ' 0 relbow A 15sl ) r ' rwrist (S / ' / / r lhip ' ' Ì2 / ' / ' rgrip trajectory of (/,, lknee ' rgriP lknee Fixed ' Jb lankle lball Figure 7: Schematic of human figure. The critical kine- matic chain linking the endpoints at the left ball of foot which, in this example, does not move and the right grip, which moves along a trajectory that we have already pre- dicted. One needs to predict the locations of the nine inte- rior markers of the ten link chain as labeled in the diagram. When this is done, the three smaller chains consisting of the right leg, left arm and head can be predicted. the remaining markers on this chain required only a pivot angle to describe. When the left hand was holding the box, the angles de- scribing the orientation of the box were modeled. Thus the position of the left grip was derived from the right grip together with the predicted box angles. For the motions were the left grip was empty (returning to the rest position or reaching to grasp the box on the shelf), the trajectory of the left hand was independently modeled in the same way as the right hand. The two link head chain did not have a fixed endpoint so that the angles describing the orientation were simply modeled using local angles. In order to make a prediction, it is necessary to provide the segment lengths (the distances between adjacent mark- ers). Various studies have been made concerning these lengths and how they vary as a function of anthropometry. In this case, we fit simple regression models to describe these lengths as a linear function of stature. For this small number of subjects, there was no evidence that more than stature alone would be helpful in predicting these lengths. Other segment length specifications can easily be used. Various schemes for selecting the nearest neighbors were contemplated and then evaluated using crossvalidation. Each motion in the database was left out in turn. We pre- dicted this left out motion using all the other motions and compared this prediction to the motion derived from the parameters of the left out motion. Because link lengths based on those predicted for a person of that height and the B-spline based representation of the parameters was used, the comparison was not exactly between prediction and observed motion data. Such a comparison would be possible but it would require using the actual link lengths which would typically not be known in the usual predictive scenario. One obstacle to constructing a scheme for measuring similarity is that the characteristics such as the target lo- cation and age of the subject are on quite different scales. For this reason, we considered only information based on the ranks of ''xdata - xpredict'' where the norm || • || is the absolute value for univariate quantities like height and Euclidean distance for the target coordinates. The par- ticular scheme that gave the lowest crossvalidated error was based on the rank of sum of the target ranks and the stature ranks. When k nearest neighbors were con- sidered, the nearest neighbor was given weight k in the average, the second nearest weight k - 1 i.e. triangular weights. Other schemes that used age, gender, weight, strength, time taken for the move and various weighting schemes for the average were inferior to that chosen. For the data considered here, 5 neighbors gave the best re- sults. It's likely that the best scheme may differ for other databases but it would be possible to evaluate a variety of schemes in new settings to find the best choice. For this data, for the optimal scheme and number of neigh- bors, the median of the average difference between the predicted and observed motions over the markers and the complete motion was 8.1cm. There were 1 00 duplicated motions in the database where the same subject reached to the same target. The median distance between these pairs of motions averaged over the markers and the complete motion was 6.8cm. This fig- ure represents the natural variation in reaching motions - it would not be reasonable to expect any prediction model to predict with greater accuracy than this. This suggests it would not be possible to make substantial improvements on the method we have described above for this dataset. Clearly, one can't say how well the method will perform for other datasets, but this does give some cause for opti- mism. One important advantage of using stretch pivot coordi- nates over other methods that require optimization is that it is fast. To predict all four phases of the motion required only 0.01 seconds on an 850Mhz Pentium ill PC. The al- gorithm was implemented in C but without any special ef- forts at optimization. This speed makes it practical for ap- plications where rapid animation is important. We have also applied the functional regression method to model the functions that describe the dynamic posture. We have found that it is impractical to fit models to the en- tire target region. The patterns of motion change with the target and it is difficult to devise a single functional form to describe this. Instead, we subdivide the target area into regions determined by proximity to an experimental target 729</page><page sequence="9">and fit a regression model to the data within this region. When a new prediction is needed, the sub-model corre- sponding to the nearest experimental target will be used. Motion capture technology is far from perfect. Problems with the data collection occasionally result in damage to the data. This includes missing and improper measure- ments. With a large database such as this, it is diffi- cult to detect all such problems. Movements which are clearly incorrect are easily detected but those that have milder problems can be hard to find particularly by auto- matic screening methods. For these reasons, we used ro- bust regression methodology in the functional regressions and used the median rather than the mean in the nearest neighbor averaging. COMPARISON There are many competing methods of human animation. A large class of such methods is not based directly on data, but on theories about how people move. Others are content to directly use motion capture data for ani- mation, perhaps hand-editing the motion for their require- ments. However, my method is most reasonably com- pared to other methods that use motion capture data to predict motion with specified constraints. Two recent papers provide a review of the current state of research in this type of problem. [17] present a parame- terization of a popular seven degree of freedom model for the shoulder, elbow and wrist with the hand constrained to a target as in this case. Many previous approaches to this problem have specified the angles describing the orien- tation of the limb segments and then resolved the redun- dancy caused by the over-parameterization by optimizing some criterion to fix the position of the arm. In contrast, the advantage of their approach, and my own, is that the position of the arm can be explicitly and easily calculated without optimization. [17] describe the competing meth- ods and show that their explicit method is typically orders of magnitude faster than those based on optimization. My method also allows the explicit computation of posture without optimization and will thus enjoy a similar speed advantage over optimization based approaches. Further- more, it applies to a kinematic chain of any number of links and the amount of computation is linear in the number of links. In contrast, the difficulties with optimization based methods rapidly increase with the number of links - com- plexity, local minima and sensitivity to initial values all be- come more problematic. This approach was developed after failing to find a workable optimization-based inverse kinematics solution to a full body linkage. [8] addresses motion prediction rather than just static pos- ture. He reviews the existing methods for editing a single motion to meet new objectives or constraints. Problems arise in editing successive frames of the motion to meet constraints while maintaining continuity. My method inher- its the smoothness and characteristics of motion capture data while adjusting to new constraints. It also does this much faster than methods that require some optimization. This representation has some weaknesses. For example, most joints have mobility restrictions but this method does not explicitly respect these restrictions. Since the method is based on empirical data, these limitations will tend to be exceeded only on larger extrapolations. Nonetheless, the problem may occur. In such cases, the dynamic posture predicted by this method may serve as an initial estimate requiring some correction. For example, this standing fig- ure occasionally has a predicted ankle position that would put the heel through the floor. This can be corrected by moving the ankle upwards to the first valid position while simultaneously moving the knee outwards in the originally predicted plane of the ankle, knee and hip. Some other methods explicitly respect these restrictions, but at sub- stantial cost in speed of computation and complexity. One finds it substantially faster and simpler to make local cor- rections to the posture if they are needed. Furthermore, more complex constraints may be needed. In this example of the two-handed box lift, it might hap- pen that the predicted left hand position is too far for the left arm to reach. Although this hasn't been a problem in practice, one would prefer to have a parameterization analogous to the stretch pivot for more complex linkages than simple chains. Such parameterizations that avoid op- timization should be the topic of future work. DISCUSSION Most of the weaknesses in the methodology described above lie in the fact that it uses no biomechanical knowl- edge. There are limits on motion imposed by considera- tions of balance and joint mobility while other considera- tions such as comfort mean that some postures, while not forbidden, are discouraged. There are other biomechan- ical and psychological considerations that affect motion. Naturally, these topics have been the subject of consid- erable research and yet it is clear that a complex com- bination of these considerations would be necessary to construct a predictive model of any versatility. Our model is empirical and is only so good as the data it is based upon. In our case, the predictive performance declines as one specifies inputs that are far from those observed in the experiment. For example, if one inputs a target far to the left of the subject, one cannot expect a good prediction since all the targets in the experiment were the right of the saggital plane. Such failings are in- evitable and can be rectified by collecting more data with the required input conditions. Alternatively, biomechanical laws can help by detecting violations and suggesting the appropriate correction. The current method also contains no notion of obstacle avoidance. If the hand must avoid some obstacle then the trajectory prediction must be suitably modified. This seems feasible enough but more problematic are obsta- 730</page><page sequence="10">cies that intersect with other parts of the body. An even more difficult problem occurs when the predicted posi- tion of the body intersects with itself. For example, on reaches to targets near the feet, one needs avoid predic- tions where the hand passes through the knees. Another difficulty is that DHM models, such as Jack, Delmia and others, all use different representation of the posture. We have used 23 markers to represent the pos- ture but this ignores various details. Furthermore, differ- ent posture models use different linkages and impose dif- ferent constraints. To make practical use of our models re- quires a mapping to and from the our linkage to the DHM linkage. There is no straightforward solution to this as it requires an in depth understanding of the chosen DHM linkage which differ from vendor to vendor. We have made such a mapping for Jack and our industrial partners have made a mapping to the Delmia figure. So to conclude, our method is not the complete solution to the problem of human motion prediction. It enables some extrapolation from a database of motions but will begin to fail for more extensive extrapolations. The scope of the method depends on the quality and range of the database of motions. ACKNOWLEDGMENTS Thank you to Don Chaffin and the other members of the HUMOSIM laboratory. The work was made possible by the funding of Ford, General Motors, International Truck, Daimler Chrysler, Lockheed Martin, the US Postal Service and US Army TACOM. APPENDIX Range of Sum and Difference of Stretch Parameters Qsmax- Sôt (ļsmax ~ 2 blit • if md - mp &gt; mpd set qsmax - ( mpd + mp + md)/md • if Hip tnd ^ lii pd Set qsmax - (mpd T rnp T wid) I IH p Çsmin ■ • If mpd &lt; md then set a = mpd/md else set a - ( mpd - md + mp)/mp • If mpd &lt; mp then set b = mpd/mp else set b = ( mpd - mp + md)/md • Set qsmin = min(a,b). Let x = pp + pd. Çdmax- • Set a = 2(mp(ļ + xrrip) / (mp + md) - x • If mp &gt; mci set b - x - 2(mpd - xmd) / (mp - md) else set b = 2 • Set qdmax = tnin(x , 2 - x, a: b) qdmin ■ • Set a = x - 2(mpd + xmd)/(mp + md) • If mp &lt; md, set b = x - 2{mpd - xmd)/{mp - md) else set b=- 2. • Set qdmin = min(-x,x - 2, a, b ) REFERENCES [1] K. Abdel-Malek, W. Yu, M. Jaber, and J. Duncan. Re- alistic posture prediction for maximum dexterity. In 2001 SAE Digital Human Modeling for Design and Engineering Conference, number 01-211 0, 2001 . [2] N. Badler, C. Phillips, and B. Webber. Simulating Hu- mans: Computer Graphics Animation and Control. Oxford Univ. Press, New York, 1993. [3] D. Chaffin. Simulation of human reach motions for ergonomics analyses. In 2002 SAE Digital Human Modeling for Design and Engineering Conference, pages 9-24, 2002. [4] J. Faraway. Regression analysis for a functional re- sponse. Technometrics, 39:254-261, 1997. [5] J. Faraway. Modeling reach motions using functional regression analysis. SAE Technical Paper 2000-01- 2175, 2000. [6] J. Faraway. Modeling hand trajectories during reach- ing motions, submitted for publication to Journal of the American Statistical Association, 2001. [7] J. Faraway and J. Hu. Modeling variability in reach- ing motions. In 2001 SAE Digital Human Modeling for Design and Engineering Conference, number 01- 2094, 2001 . [8] M. Gleicher. Comparing constraint-based motion editing methods. Graphical Models, 63:107-134, 2001. [9] M. Gleicher and P. Litwinowicz. Constraint-based motion adaptation. The Journal of Visualization and Computer Animation, 9(2):65-94, 1998. [10] E. Gu, Y. Teng, and L. Oriet. A study of human joint torque distribution for optimal posture auto- generation. In 2002 SAE Digital Human Modeling for Design and Engineering Conference, pages 421- 430, 2002. 731</page><page sequence="11">[11] S. Hsiang and M. Ayoub. Development of method- ology in biomechanical simulation of manual lift- ing. International Journal of Industrial Ergonomics, 17:271-288, 1995. [12] R. Johnson and D. Wichern. Applied Mulivariate Sta- tistical Analysis. Prentice Hall, New Jersey, 3rd edi- tion, 1992. [13] J. Korein. A Geometric Investigation of Reach. MIT, Cambridge, MA, 1985. [14] J. Lee and S. Y. Shin. A heirarchical approach to interactive motion editing for human-like figures. In ACM SIGGRAPH 99, Annual Conference Series, pages 39-48, 1999. [15] J. Ramsay and B. Silverman. Functional Data Anal- ysis. Springer, New York, 1997. [16] J. Simonoff. Smoothing Methods. Springer- Verlag, New York, 1996. [17] D. Tolani, A. Goswami, and N. Badler. Real-time inverse kinematic techniques for anthropomorphic limbs. Graphical Models, 62:353-388, 2000. [18] X. Wang. A behavior-based inverse kinematics algorithm to predict arm prehension postures for computer-aided ergonomie evaluation. Journal of Biomechanics, 32:453-460, 1999. [19] X. Wang. Three-dimensional kinematic analysis of influence of hand orientation and joint limits on the control of arm postures and movements. Biological Cybernetics, 80:449-463, 1 999. [20] D. Wiley and J. Hahn. Interpolation synthesis of artic- ulated figure motion. IEEE Computer Graphics and Applications, 17:39-45, 1997. [21] A. Witkin and Z. Popovic. Motion warping. In Com- puter Graphics (Proc. SIGGRAPH '95), 1995. [22] X. Zhang, A. Kuo, and D. Chaffin. An optimization- based differential inverse kinematics approach for modeling moderately complex three-dimensional dy- namic seated postures. Journal of Biomechanics, 31:1035-1042, 1998. CONTACT Julian Faraway, Department of Statistics, University of Michigan, Ann Arbor, Ml 48104, USA. Tele- phone (734)-763-5238, Fax (734)-576-2173, Email far- away@umich . edu 732</page></plain_text>