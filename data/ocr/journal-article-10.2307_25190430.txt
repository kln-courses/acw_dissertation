<plain_text><page sequence="1">PHILOSOPHICAL TRANSACTIONS pM ^^ R ^ A (2Q07) 365 log_131 THE ROYALi% doi:10.1098/rsta.2006.1922 SOCIETY AM. Published online 17 November 2006 The TUM walking machines By Friedrich Pfeiffer* Institute of Applied Mechanics, Technical University Munich, 85748 Garching, Germany This paper presents some aspects of walking machine design with a special emphasis on the three machines MAX, MORITZ and JOHNNIE, having been developed at the Technical University of Munich within the last 20 years. The design of such machines is discussed as an iterative process improving the layout with every iteration. The control concepts are event-driven and follow logical rules, which have largely been transferred from neurobiological findings. At least for the six-legged machine MAX, a nearly perfect autonomy could be achieved, whereas for the biped JOHNNIE, a certain degree of autonomy could be realized by a vision system with appropriate decision algorithms. This vision system was developed by the group of Prof. G. Schmidt, TU-Miinchen. A more detailed description of the design and realization is presented for the biped JOHNNIE. Keywords: walking machines; design and layout; control; sensors; actuators 1. Introduction (a) General remarks Walking is one of the most important results of biological evolution. Walking animals do not need any prepared areas like roads, tracks, harbours or airports; they are able to cope with most of the surface structures existing on the Earth. But walking needs intelligence, some neurobiologists say, motion is intelligence. All biological cognitive systems have learned from walking and are at the same time a basis for walking performance. The interconnection of sensors, muscles, cordal spine and brain intelligence is extremely complicated and not completely understood by neuroscience. The biological evolution came out with very perfect and sophisticated solutions, which meet all the requirements for the environment of the specialized biological system under consideration extremely well, far away from today's technical performances (Pfeiffer &amp; Cruse 2005). The technological aspects of walking comprise nearly all the important technological fields due to the interdisciplinary character of walking machine development. In the following we shall give an overview based on the experiences made with the realization of the six-legged machine MAX, the eight-legged machine MORITZ and the biped JOHNNIE (Pfeiffer &amp; Zielinska 2004). We have to consider two broad areas, the mechanical and the control engineering side, but both the fields include everything else: sensors; actuators; vision; decision * pfeiffer? amm. mw.tum.de One contribution of 15 to a Theme Issue 'Walking machines'. 109 ? 2006 The Royal Society</page><page sequence="2">110 F. Pfeiffer capabilities; and the like. We mainly present the technology of JOHNNIE standing in for most of the technological features, which are commonly used in today's walking machine design (e.g. Gienger et al. 2001; Pfeiffer 2002; Pfeiffer et al. 2002). To illustrate the event-driven and decision-oriented character of walking machine control, we also shall give a short survey of our six-legged machine MAX and eight-legged machine MORITZ. (b) Design aspects of walking machines The design of walking robots is, as for all technical systems, an iterative process. In general technology, one may start with existing issues; in the field of artificial walking, it makes sense to start with some experiences from human walking. This is done more or less all over the world, which may be seen from the phenotypes of technical walking (Yamaguchi et al. 1994; and the machines by Honda, Toyota and Sony). We shall discuss the design process as used at the Technical University of Munich on the basis of the biped example JOHNNIE (figure 10). The first step of the design phase is the choice of the joint structure. It has to be ensured that the kinematics allows one to realize the planned motion. Figure 10 shows the chosen structure of 'JOHNNIE'. Each leg is equipped with six driven joints. With these degrees of freedom, the 6 degrees of freedom of the upper body can be controlled arbitrarily within the workspace of the joints. Furthermore, the upper body can rotate about its vertical axis and each shoulder is equipped with a pitch and roll joint. The upper-body joint is redundant with the two hip yaw joints, but allows for a pelvis rotation to increase the step length. With the shoulder joints, the overall moment of momentum about the body's vertical axis can be compensated. The geometry of the robot corresponds to that of a human of a height of 1.80 m (Hahn 1994). The joint structure represents the basis for all other design efforts and at the same time a starting point for developing a model of the dynamics for a first simulation step of the system. Such a simulation results in a preliminary estimate of joint torques, joint velocities, work ranges and ground reaction forces. This information is then the basis for the detailed mechanical design and the choice of the actuation. As design and simulation run in parallel, the output of the design process is a realistic estimation of masses and moments of inertia using computer-aided design tools. In addition, gear friction characteristics and motor models can be included in the simulation once they have been chosen. Figure 1 shows this iterative design process. For a fast walking motion, the actuation and structural design of the machine must be optimized. Simulation results show that DC motors with inside rotor design are the best alternative. The chosen motors are equipped with a rotor with a low moment of inertia. The commutation is realized with brushes. The chosen gears are modified harmonic drive gears and ball screw drives. They are backlash-free and have an extremely low weight and a small size. Most of the walking machines apply this solution for the drives worldwide. The joint angles and the joint angular velocities are measured by incremental encoders that are attached to the motor shafts. In addition, a reference line is evaluated. In order to obtain a reference position, light barriers are positioned in Phil Trans. R. Soc. A (2007)</page><page sequence="3">The TUM walking machines 111 design parameters _ ? &lt;*&gt; forces, torques ^^^^^ \ velocities ^^"5^. , . ^ design simulation and control actuation ^ .-,-,-, a i-,-r-r-1 &lt;*&gt; average motor torque ? 100- rechts-^ 4. , rechts-. ^ &amp; M ~ 50h k A k A H'T" 1- 2"?A ^ A * A ft,,"P"- &lt;*&gt; motor chart ? -50 ij sj ii y |j u- .s _2- " gear selection :?-ioot- ' -J "* -4L-j-j.-J ^ maximum joint velocity 01230123 ... J Q50 3000 Ume (s) ^&gt; maximum joint torque O O " [1 ' rechts -J FT ' gelcnk l'inks -^Tl ? I 0.40 \ lmks . 6000 -. **!? ''* *}H. *- w rw o/\ " \ " fc .. motorkennhnie . ^ . i j ? 0 0.30 g. 4000. structural design | f ?-20: r'^l?*^^^-^^^ 2000 jfc ^ maximum torques " ~ ' o . . : 0Mr " - ' ^ &lt;*? group reaction forces 12 3 4 12 3 ^0^^ time (s) torque (Nm) ^r system parameters ^*^^^ Q&gt; geometry ^&gt; masses &lt;*&gt; moments of inertia Figure 1. Iterative design process. the work range. Before the operation, the robot has to perform an initialization, where all joints pass the light barriers. This position is used as the basis to find the next reference line, which is the reference position. As the harmonic drive gears are very stiff, the error due to elastic gear deformation is small. The high resolution allows for an exact control of the joint position at a short settling time. The joint velocity is identified by the numerical differentiation of the joint position. To avoid damage of the robot, each joint is equipped with switches that confine the minimum and maximum joint angle. When the workspace is exceeded, the pulse-width-modulated (PWM) signal for the corresponding joint is turned off. The walking pattern is usually constrained by the limitations of the forces and torques that can be transmitted to the ground. When these limits are exceeded, the foot tilts or starts slipping. One way to avoid this is to control the ground reaction forces and torques. The strategy used here is to confine the ground reaction torque with respect to a point which lies in the middle of the foot supporting the polygon of the ground plane. For this purpose, a six-axis force-torque sensor has been developed in order to be able to measure all the required force/torque information. The control scheme requires the knowledge of the position and the spacial orientation of the upper body. As it is easily possible to calculate the position with respect to the stance foot, problems arise if the orientation has to be computed. In general, if the ground is horizontal, it is possible to calculate the orientation from the joint angular data. However, the measurement becomes erroneous when the foot starts tipping. Furthermore, the orientation is computed by a series of seven joint angles, such that measurement errors add up. In addition, elastic deformations of the robot's structure lead to further errors. Also, Phil. Trans. R. Soc. A (2007)</page><page sequence="4">112 F. Pfeiffer Figure 2. The six-legged walking machine 'MAX'. when walking on an uneven ground or during short ballistic phases, no orientation information can be measured. Therefore, an inertial orientation sensor system is included. 2. The logic of walking machine control (a) Introduction The control of biological systems is highly nonlinear; it is event-driven and relies on a large collection of logical decisions. At the author's former institute, three walking machines have been realized, which partly apply biological findings with respect to walking control. A one-to-one translation was achieved with the six legged machine MAX, which in spite of its age possesses one of the most modern and completely autonomous control concepts based on the control of a stick insect (Cruse 1976). This concept was again applied in a modified form for an eight-legged tube-crawling machine MORITZ, with excellent success. In the case of two-legged walking, little is known about human walking control. Therefore, comparable to all other bipeds, a multi-layered control concept is used, which after all has a much more technical appearance than the other two control structures. From this and before discussing the JOHNNIE development in more detail, it makes sense to consider the logic performances of the control systems realized so far. All walking processes include some typical phases of motion, which may be characterized by the ground contact of the feet, the ground detachment and lift off, the dynamics of the body and, very important, the dynamics of the single foot. The sequence of events during walking cannot be, and as a matter of fact are not, controlled by the classical concepts of control theory, in biology not at all anyway, but also not in technical walking. The online or, where possible, off-line path planning, the realization of controlling the complete system and component control usually are performed applying different control levels organized in a decreasing order of intelligence and an increasing order of specialization. If Phil. Trans. R. Soc. A (2007)</page><page sequence="5">The TUM walking machines 113 walking machines possess also vision capabilities, we furthermore get an overriding level of vision evaluation and task-planning. From this we may conclude that normal walking already has to take advantage of many logical decisions necessary to maintain the walking process. Even more decisions will be necessary in cases where the normal process is disturbed or even tends to become unstable. The biological control system of the stick insect, for example, includes certain neural thresholds, which become active in disturbed situations (Weidemann 1993). Human beings control unstable situations by shifting masses and extremities (legs and arms) in a predictive way. The underlying control concept is not very well known, though. The walking machines under consideration are a six-legged machine very much based on the biological findings concerning the stick insect (Weidemann 1993; Eltze 1994; Pfeiffer &amp; Cruse 1994; Pfeiffer et al. 1995; Pfeiffer &amp; Steuer 1999), an eight-legged tube-crawling robot, including some biological ideas and a complex system of logical control objects (Pfeiffer et al. 1995; Rofimann &amp; Pfeiffer 1996; Rofimann 1998; Pfeiffer &amp; Steuer 1999), and a biped robot with the goal of fast walking and a second goal of vision-controlled walking (Loffler et al. 2000, 2002). Inspite of the fact that we deal with our own machines, they nevertheless represent some typical problems and features that can be found in all walking machines realized so far (Waldron 1986; Neubauer 1993; Hirai et al. 1998; Kuffner et al. 2002). (b) Logic-oriented walking control (i) Six-legged machine MAX The six-legged machine MAX (figure 2) has a weight of 23 kg and a length of about 1 m. The main ideas for the control system of this six-legged robot were taken from neurobiological research with stick insects (Cruse 1976; Pfeiffer &amp; Cruse 1994). The technical realization follows in its performance very closely to biological principles. A global leg coordination module (LCM) is an information level, where each leg informs its neighbouring legs about its state, influencing the decision functions of each single leg controller (SLC). The LCM is responsible for setting the landing and lifting points of each leg (in the following AEP is the anterior extreme position and PEP is the posterior extreme position). By controlling these points, the global behaviour of the walking process can be influenced. Although this level is doing a global task, the control mechanism works locally. In figure 3, this mechanism is depicted. It can be seen that the neighbouring legs can shift the AEPs and PEPs by small amounts. Thus, legs can inhibit the adjoining legs from lifting off the ground by postponing their PEPs. Each leg gets specific information from the other legs, namely the walking phase, the velocity and the AEP and PEP values. This information is sufficient for each LCM for computing its new AEP and PEP. These values are sent to the middle control level. There is no central supervision. The control influences used in this approach have been measured and isolated by neurobiologists. Up to eight control mechanisms can be implemented in the LCM; the principle of the two most important ones is shortly explained in the following: given that the rostrally neighboured leg is Phil. Trans. R. Soc. A (2007)</page><page sequence="6">114 F. Pfeiffer Figure 3. Control concept of the six-legged walking machine 'MAX'. not yet in STANCE phase, the control inhibits the lifting of the leg in shifting back the PEP by a certain increment. Similarly, the control inhibits a start of the lifting phase when the contralateral adjacent leg is not yet back in STANCE phase. The SLC is the heart of the leg motion performing all decisions necessary to move the leg and to control the various phases. The order of the different phases in a normal step is STANCE, PROTRACT, SWING and RETRACT (figure 3). The SLC switches between the phases in dependency of the AEP, the PEP and some specific events (e.g. hitting an obstacle). It performs some online path planning at the beginning of the PROTRACT phase. Moreover, the SLC adds some local intelligence, which is needed especially for managing obstacles, impacts or other unforeseen events. The SLC detects and surpasses obstacles, controls body height and corrects slippage effects. The capability of obstacle avoidance is achieved by means of a special detection mechanism and a different approach to general path planning. During SWING phase, the SLC monitors the bending load in the leg segments. Whenever the corresponding strain gauge signal exceeds a certain threshold value, the obstacle avoidance mechanism is activated. A short RESWING phase is executed followed by a new SWING phase trying to pass the obstacle. Phil. Trans. R. Soc. A (2007)</page><page sequence="7">The TUM walking machines 115 Figure 4. The pipe crawling robot MORITZ. In addition to the two upper levels, the leg needs a low-level control system that typically, and again near the biological performance, consists in a feedforward nonlinear decoupling scheme combined with a feedback linear controller. The low-level controller for the AIR phase (which includes PROTRACT, SWING, RETRACT and RESWING) resembles a manipulator controller with online path planning. The controller for the AIR and STANCE phases differs in the controlled coordinates (Weidemann 1993; Eltze 1994; Pfeiffer et al. 1995; Pfeiffer &amp; Steuer 1999). (ii) Eight-legged machine MORITZ Tube systems differ in their pipe diameters, lengths, the medium inside, the complexity of the tube arrangement and others. Different kinds of robots have been developed for inspecting and repairing tubes from the inside (Neubauer 1993; Rofimann &amp; Pfeiffer 1996; Rofimann 1998). They are driven by wheels or chains or they float with the medium. All types of robots have their specific difficulties, for example problems of traction or low flexibility, and do not satisfy all requirements expected by the users. The aim of this project is the development of a robot moving forward by feet to study the possibilities and difficulties of legged locomotions in contrast to other systems. The higher flexibility of legged motion can be used to extend the technical possibilities of moving in tube systems (figure 4). The robot has eight legs arranged like two stars. The attachments of the eight legs are located in two planes that intersect at the longitudinal axis of the central body. These planes are called leg planes. Each leg has two active joints, which are driven by DC motors. Their axes of rotation are orthogonal to the leg planes. This provides each leg with a full planar mobility. The leg is mounted on the central body with an additional passive joint, which allows small compensating movements in the normal direction. The crawler has a length of about 0.75 m and is able to work in pipes with a diameter of 60-70 pm. In each of the eight legs, the distance between the two active joints (hip and knee) is 15 cm and the length of the last leg segment (from Phil Trans. R. Soc. A (2007)</page><page sequence="8">116 F. Pfeiffer local coordination central coordination local operating level (leg plane 1) (leg plane 2) /leg plane 1 &gt;^ I-1 V in stance J I-1 i? protract *-. / ^? ?' r? retract &lt;-. 1 1 * w^?L-^, 1 1 swing [stance ^V-Xje8 switching^ ! stance swing I I ^^Tl^^ * I T I I 4r_I / I I - retract ?' ^^ &gt;\/ "- protract ?' ( leg plane 2 ) \in stance^ 4x lx 4x Figure 5. Level of coordination. knee to foot) is 17 cm. The highest possible torque of the hip joint is 78 and 40 N m for short term and permanent, respectively. The corresponding values of the knee are 78 and 20 N m. In stretched-out position, a leg is able to carry 6.5 times its own weight (less than 2 kg) permanently and 12 times for short-time operations (Rofimann &amp; Pfeiffer 1996; Rofimann 1998). The control structure enables the robot to move through straight and curved pipes independently of the position inside the tube or the inclination of the tube (from horizontal up to vertical pipes). Considering the experiences with the six legged walking machine, a structure was chosen, which is divided into two hierarchical levels. The upper level encloses the mechanism of coordination. The lower level controls the position and forces (it executes operating functions). Based on this division, it is possible to realize a functionally orientated structure and to leave the solution of problems to the concerned components (Pfeiffer et al. 1995; Rofimann 1996). Figures 5 and 6 show the principles of the coordination and the operating levels for the load phase. ? The central coordination level coordinates the phase characteristics of the two leg planes. Decisions on switching of the legs under load are made by this component. The legs do not have any autonomy with the advantage of higher safety from falling. With respect to this property, the concept differs from other solutions (Weidemann 1993). Furthermore, the problems that can only be mastered by a reaction of the whole robot should be solved in this level (e.g. the legs of one plane cannot find any contact). ? The local coordination level controls the step cycle of a single leg, especially the sequence of leg motion phases (STANCE, PROTRACT, SWING and RETRACT). It also reacts to disturbances induced by small obstacles. ? The central operating level controls the position and the velocity of the central body, which are estimated from the joint angles of the legs. This is done by changing the leg forces to achieve accelerations for correcting the control Phil Trans. R. Soc. A (2007)</page><page sequence="9">The TUM walking machines 117 local operating level central operating local operating level (leg plane 1 in stance) level (leg plane 2 in stance) I- XB4 XB8 I-1 force feedback I I force feedback control (leg 4) FB4 _ FB8^ control (leg 8) y estimation of the ^ y I-1 AB3 j- . i u ^ &lt;-1 _1U-1 force feedback-i- central body &lt;?i force feedback control (leg 3) ^B3_ r? coordinates ?-| FB7^ control (leg 7) path planning I-1 XB2 _I I_AB6 I-1 force feedback central feedback force feedback control (leg 2) 4FB2 control fb^ control (leg 6) force distribution v j-1 XB1 _I I-1-1-1 I_AB5 I force feedback force feedback control (leg 1) 4Fbi |_| |_1 FB5^ control (leg 5) Figure 6. Operating level. errors. For this purpose, the local operating level is used. It receives the corresponding set point commands. These commands must be created with respect to restrictions like satisfying the condition of sticking or the limitations of the electrical and mechanical components. ? The local operating level controls the applied forces during the contact phase and the motion of a single leg during the different air phases. In contrast to the last ones, which are pure local problems (legs without contact can be assumed as decoupled), the forces of legs touching the environment are strongly coupled, and therefore a strictly local realization cannot consider all the effects in each configuration. Therefore, local means as local as possible. Figure 7 depicts the overall concept for controlling cMORITZ'. For force control, a feedback linearization procedure was applied coming out with six compensating torques T0 to T5, which act in the sense of a kind of feedforward decoupling for the walking process (Slotine &amp; Li 1991). The machine is equipped with force sensors, angular encoders, tachometers and, in addition, the power consumption of the motors, and thus the torques are measured. Nevertheless, measurements are not complete. Therefore, three observers generate additional information about friction in the gears, gravity influence and machine kinematics. The system works without any problem. (iii) Biped walking machine JOHNNIE In the past few years, the development of sophisticated biped walking robots has increased rapidly. The reasons for this tendency are the fast improvements in the field of sensors, actuators and computers. Especially, the increase of computational power allows one to develop more sophisticated sensor fusion schemes and model based control algorithms that lead to a stable and disturbance-tolerant system behaviour of such robots. Key developments have been achieved by Hirai et al. (1998) and Kuffner et al. (2002), who developed powerful bipeds. Phil Trans. R. Soc. A (2007)</page><page sequence="10">118 F. Pfeiffer central body controller single leg controllers &lt;.x.&gt; robot motion *3 - - | compensation! w I central I I force |Fnom I force l7^. I?71 u I m. ? ~^~~ ? 9? ? - 9? ,. ^ u .. - ?? ^ ? -*9--*9?*9?*9-*B~l? Mq-h=J1F+Bu?t-? l_ controller " distnbution " controller .' ?-?I M I T f I-1-1 ? -1-? mv dynamics T{ | 1 \Zp\m ' - (central body) T5 '-' T I-:-1 2 friction ? observer ?i Pq gravity -. I-. observer ? L leg motion _ - |compensation| "t* ac -1 ^leg' Q\tg i-1 '- robot motion -'-'-^q, leg observer *~ F I-*-1 _|_j^-1_ foot f,legi~ dynamics |xtube Figure 7. Overall control concept for 'MORITZ'. Figure 10 shows the assembled robot 'JOHNNIE' (Gienger 2005; Loffler 2005). It is equipped with 17 joints. Each leg is driven with six joints, three in the hip, one in the knee and two (pitch and roll) in the ankle. The upper body has one degree of freedom (DOF) about the vertical axis of the pelvis. To compensate for the overall moment of momentum, each shoulder incorporates 2 DOF. The 6 DOF of each leg allow for an arbitrary control of the upper body's posture within the work range of the leg. Hence, such major characteristics of human gait can be realized. The robot's geometry corresponds to that of a male human of a body height of 1.8 m. The total weight is about 40 kg. The biped is autonomous to a large extent; solely power supply and currently a part of the computational power are supplied by the cables. Each joint is equipped with an incremental encoder, which is attached to the motor shaft. During walking, it is important to measure and control the ground reaction forces and torques. The biped robot 'JOHNNIE' is equipped with two six axis force/torque sensors that are integrated in the foot. The geometry of the sensor has been developed on the basis of simulations. The forces and torques acting on the foot for a jogging motion have been determined with a detailed multibody simulation program. Based on these data, a sensor layout has been chosen. An attitude measurement system is integrated in the upper body. The orientation is determined by a combination of gyros and accelerometers. The acceleration sensors produce erroneous results when the body rotation is superimposed by translational accelerations. On the other hand, integration of the velocity data leads to an unbounded error due to noise and disturbances in the measured gyro signals. To overcome these problems, a variety of sensor fusion methods have been proposed. The scheme that is employed here is based Phil. Trans. R. Soc. A (2007)</page><page sequence="11">The TUM walking machines 119 Hi-i-i^-J?-;;-i- . ^ ,?-. &gt;&gt; . -v I ; &lt;.'. _:_ \*?. ^ ! ^ t;.^"*J? global gait coordination I double M single I L * '$-? ?*t-?- -7-p-R-:?"' &gt;iJ I support n support | I ,-g^. ^ ^ ./ j ? . . a;. ., ; , I double I I heel I -3 I foot I 1 , I ,. p support 1 "j liftoff 1 ,J pi liftoff I "1 airphase) ;, ; |touchdown| (walking) I jfootf I ^ j 1.h^f | (jogging) |touchdown| ^ ... -. trajectory generation dermination of step length _ selection of /TxperN controlled variables walking jogging Vstepy { , . rri. -^-computation of reduced offline-gait parameters model optimization ^??f--' gj yMf.^y, |- 4 I-*8 I reference I R/^lvvV "t^Ssr^ "*" trajectories control of the system dynamics /xa feedback linearization /q\ ? vw r. ,_5_, 1 UJ /i\ It- a /-rTT~^~T~HJ(J Mq+W,A = h+Q A rrzj| ui * *?;*?-*i -,l I k-T-T- -' j /?g\ (. .-1-. j friction observer-*- 8 Hi force sensors '-' 1-??-?1 nj '-' gravity/position ? ?_ ' I 7^7 I observer h*?| gyroscopes/1 ( ) rr-J-1 (a) " ?1 inclinometer I-kZ-(?)=f(q,?L?l Vq/ I W 1 *x'_I position sensors I_foot_I Figure 8. Control concept of 'JOHNNIE'. on complementary filtering of the gyro and accelerometer signals. The basic idea is to weight the sensor data in frequency ranges, where the respective sensor can be considered as ideal. The control scheme is a three-layer concept, as shown in figure 8. If the biped is, in addition, vision-controlled, we get a fourth layer deciding on the walking tasks and requirements. In figure 8, the lowest layer includes a feedback linearization scheme mainly applied to stabilize the machine and to ensure a safe basis for the higher layers. As the realization of a feedback linearization is rather sensitive with respect to parameter uncertainties, we need some observers to estimate friction, Phil. Trans. R. Soc. A (2007)</page><page sequence="12">120 F. Pfeiffer microcontroller: sensors 0.5 ms analogue central PC: 4 ms , microcomro?er 0 ^V^uiin feedback linearization foot torclue control -^^?[force sens.j /xsolA ,_, f-1^5-,3x3_| encoder | \ksJ |- |frictioncomPensationh-1 encoder evaluation | ^ I ^ | H J microcontroller 1 I-H voltage I jf I position control centre of gravity I ,?I Mq + w, T = h + Qe I filter position foot 0 ^xF_| footpos | (iW_T = 20ms_-L2- Jq = w , -4JJIZL -encoder evaluation 4xq . W -r-.-?:- T = (JM ' w.')(w+JM'(h=Qj) _T^ | eniuucr | j~ position control rest system I___I - I Jq=-A,(x-x ^-A^x-x^-Jp j T h J microcontroller 2 ^H TOltaSe j jl /q\ _ I-filter orientationsens.-^?*?| gyro/accel.| \q/ gravity/position ,^_I - encoder evaluation 3xq --j?1 observer '-' - (?) I-1 n?, * c* T H J microcontrollers I-^H voltage ] Vx/ /x\ ~ .v 27xq, 6xF, 6xT -.. &gt; 6vF ._. -U/= q'q "*-?-er p?sition foot l + 1 foot p?s-1 -1 ? encoder evaluation 4xq ,-, I_|-^-1 encoder | I-1 3xlLi?1-1 _, ^ microcontroller 4 ! voltage | foot torque control ? xc^ [force sens.I T=4ms 3xq .-. -;?:-^- encoder encoder evaluation | '-' Figure 9. The feedback linearization concept. gravity, position and orientation. It is one of the drawbacks of the feedback linearization, resulting in relatively large computing times. Figure 9 illustrates the concept in a little more detail. Thirty-nine measurement signals enter the control block, 27 signals for the joint status and 12 signals for forces and torques at the feet. After being processed in the control loop, the power signals for the joint actuators leave the control block. The complete processing from the measurements to the power signals takes ca 4 ms, which is still too long for fast walking or jogging. The second layer in figure 8 concerns the process of trajectory generation for normal and fast walking and for jogging, where the control and trajectory parameters are evaluated, the reference values are determined, and where, finally, the feedback linearization will be activated. The computation of the reference trajectories is crucial for a stable motion of the robot. In particular, all existing constraints have to be satisfied throughout the entire gait cycle. Nevertheless, the trajectories are not uniquely defined by these constraints. An infinite number of trajectories are possible for a given walking speed, such that the most suitable trajectory has to be determined by an optimization. Possible cost functions are the energy consumption, the global stability of the system or aesthetic aspects. While an optimized trajectory leads to a very good system performance when tracked exactly, it is not necessarily the best solution for a real walking machine. Highly optimized trajectories are usually computed as spline curves in terms of the joint angles. It is very difficult to adapt these trajectories in case of disturbances and to change the gait pattern in an unknown environment. A modification of the trajectories would require a huge database or an online optimization of the trajectories. Presently, both solutions work only in simulations, since they require extensive computational power and cannot be used for a system operating in real time. Biological systems do not track a given Phil. Trans. R. Soc. A (2007)</page><page sequence="13">The TUM walking machines 121 Figure 10. The biped 'JOHNNIE'. set of trajectories extremely exactly, but adapt their motion to upcoming disturbances and can compensate for a great part of sensor errors, inaccurate tracking and disturbances. Therefore, we use a reduced model for the computation of dynamically stable reference trajectories. The solution is not completely exact, but it can be computed in real time and allows for an adaptation of the trajectories during walking. In this way, it becomes possible to compensate model inaccuracies as well as external disturbances. The highest layer in figure 8 deals with the global walking coordination, including features like walking, jogging and standing, the last one requiring certain control measures. The various phases of these features have to be coordinated correctly and transferred to the next layer of trajectory generation. As already mentioned, a supervisory layer has been realized for vision control (Prof. G. Schmidt, TU-Munich; Lorch et al. 2000; Schmidt et al. 2001; Schmidt 2005; figure 10). Finally, two additional aspects should be mentioned: the problem of constraints and the important properties of foot dynamics. One of the main difficulties in the control of dynamically walking robots results from the constraints that limit the applicability of conventional control concepts. Two groups of constraints need to be considered. First, the workspaces of the joints, the maximum rotor velocities and the joint torques are limited. These are typical constraints for industrial robots, and these can be satisfied by an adequate design and an appropriate choice of the trajectories. However, critical control problems result from the second group of constraints that describe the unilateral contact between the feet and the ground. Depending on the normal force that is transmitted from the foot to the ground, the maximum transmissible torques as well as the tangential forces are limited by the corresponding friction cone. While practical experiments show that the robot usually does not start slipping, the limits of the torques in the lateral and frontal direction lead to a small margin of stability. From human walking we know that foot dynamics is a crucial point for any walking or running process (Nishiwaki et al. 2001). Forces and torques at the feet contribute significantly to the stability of the system. For example, when the Phil. Trans. R. Soc. A (2007)</page><page sequence="14">122 F. Pfeiffer orientation of the upper body deviates slightly from its reference, the foot torques are increased to bring the orientation back to its reference value. Depending on the time constants that were chosen for tracking the orientation, the foot torques can easily exceed their maximum limits. The feet would tilt even though the robot is very close to its reference trajectory. Therefore, a direct measurement and control of the foot torques is inevitable when the motion of the robot is based on an orientation sensor. For our robot, it is particularly easy to control the foot torques with a high bandwidth. The torques of the feet depend only on the forces of the ball screw drives that actuate the ankle joint. These are controlled by the same microcontroller that also reads in the data of the six-axis force-torque sensor. The controller operates at a sampling rate of 0.4 ms. Steady state errors due to gear friction are compensated by a friction observer. The control scheme has been verified in experiments. 3. The concept of JOHNNIE Anthropomorphic walking machines have been realized for more than 20 years, where most of these activities took place in Japan and in the US. Within the framework of this paper, we cannot review these efforts. It is well known that the Japanese position in this field is very strong, thanks to the very early activities of Prof. Kato at Waseda University, which is still a centre today, thanks also to the ongoing research at the universities largely under the leadership of Prof. Inoue and, last but not least, thanks to the engagement of various large companies, for example Honda (Hirai et al. 1998). At the MIT in the US, a number of walking and jumping bipedal robots have been realized, and strong groups are at Carnegie Mellon. The robots range from two dimensional walking and hopping robots to sophisticated three-dimensional machines (Raibert 1986). Besides the Japanese groups, there are many other centres that work on biped walking problems. Generally, the number of research groups working in the field is increasing since major application areas become apparent. In particular, service robotics, medical applications and operation in hazardous environments are of primary importance. Another reason must be seen in the modern technological capabilities, including better actuators, cheaper sensors and faster processors. (a) Requirements From a large project at the author's former institute concerning normal and hemiparetic human walking, it was easy to take the quite well-known data of human walking for a first layout. As a matter of fact, these data refer more to mechanical properties, such as kinematics, masses, moments of inertia, torques and forces, and not so much to human walking control, sensors and actuators. The requirements for the sensors come from the technical control concept, which is a combined position-force-control system. The state of all joints must be known, the force/torque situation at each foot must be measured and an inertial reference must be given. Therefore, encoders and tachometers, six-component force-torque sensors and an inertial platform are needed. Quantities like friction, which are not measured, can be estimated by observers. Phil Trans. R. Soc. A (2007)</page><page sequence="15">The TUM walking machines 123 yaw Figure 11. Design of the hip joint. Altogether, the most important requirements are as follows. size 1.80 m weight &lt; 50 kg max. speed 1-2 m s_1 configuration humanlike degrees of freedom leg 6 DOF foot (internal) 4-8 DOF sensors encoders force torque sensors inertial platform actuators Neodym-Bor DC motors harmonic drives gears ball screws (b) Mechanical models The design aspects are discussed in detail in ?16. In the following we shall consider some more details concerning the hardware selection. Figure 11 shows a sectional view of the final version of the hip joint. The actuation for the yaw and roll axis is arranged coaxially with the joint axis and is integrated in the aluminium structure. The yaw joint is inclined 15? with respect to the pelvis. This leads to a better power distribution among the four hip motors. The pitch Phil. Trans. R. Soc. A (2007)</page><page sequence="16">124 F. Pfeiffer Table 1. Technical data of the hip joint. yaw roll pitch motor Maxon RE40 Maxon RE40 2XMaxonRE40 gear HFUC25-160-UL HFUC26-160-UL HFUC26-80 modified transmission ratio 160 160 80 maximum static joint 178 178 220 torque (N m) average static joint 22.3 22.3 22.3 torque (N m) maximum joint 4.7 4.7 9.4 velocity (rad s_1) joint is actuated with two motors via a timing belt. The employed gear has a modified circular spline, which is T-shaped in order to reduce weight. Further, an aluminium wave generator with an optimized shape is included. Its moment of inertia is 50% lower than that of the standard series. The shank includes the PWM amplifiers for the knee joint actuation. Table 1 shows the technical data of the joints. The design of the knee joint corresponds to that of the hip pitch joint. The actuation of the ankle joint is realized with two linear drives based on ball screws. Two motors drive the ball screws via a timing belt. The motion of the sliders in the same direction leads to a pitch motion of the foot; the roll motion is realized by moving the sliders in reverse direction (figures 12 and 13). The foot consists of three separate bodies. The two lower foot plates are connected by a rotational joint about the foot longitudinal axis, ensuring that the ground contact situation is not overconstrained. The ground contact elements are rounded, such that a smooth rolling motion of the foot can be realized during the touchdown and lift-off. The upper foot plate is connected to the lower plates by a damping element, which absorbs shocks and bridges the time gap between the impact and the controller response. (c) Sensors The joint angles and the joint angular velocities are measured by incremental encoders (HP 5550 HDSL) that are attached to the motor shafts. They have 500 lines, such that an accuracy of 1/2000 of a revolution can be achieved with the microcontroller hardware. In addition, a reference line is evaluated. In order to obtain a reference position, light barriers are positioned in the work range. Before the operation, the robot has to perform an initialization, where all joints pass the light barriers. This position is used as the basis to find the next reference line, which is the reference position. As the harmonic drive gears are very stiff, the error due to elastic gear deformation is small. The high resolution allows for an exact control of the joint position at a short settling time. The joint velocity is identified by numerical differentiation of the joint position. To avoid damage of the robot, each joint is equipped with switches that confine the minimum and maximum joint angle. When the workspace is exceeded, the PWM signal for the corresponding joint is turned off. Phil Trans. R. Soc. A (2007)</page><page sequence="17">The TUM walking machines 125 For controlling the ground contact, especially tilting or slipping, a six component force-torque sensor has been developed. Its design is based on the requirements resulting from simulations of the controlled jogging motion. As commercial sensors meeting these requirements were not available, mainly with respect to weight and size, an especially adapted sensor was realized (figure 14). Its performance with regard to the measurement range and the measurement errors is excellent. The final version is based on a classic sensor design, with three deformation beams holding strain gauges. Thin membranes make sure that defined stresses occur at the strain gauge positions. These membranes decouple the force directions to a certain extent. A detailed layout of the sensor has been performed, employing the method of finite elements. Based on the simulated force-torque information, calculations have been made to ensure that the maximum von Mises stresses are below the durability stress of the sensor material. Strain gauges are applied as half bridges on the deformation bars. The amplifier is included in the sensor housing. The control of the robot requires a precise information about the orientation of the upper body in space. Since it cannot be determined from the joint angles with sufficient accuracy, an inertial orientation sensor system is included. The upper body motion is characterized by high linear accelerations in the vertical direction and high oscillations (2 Hz at a jogging speed of 5kmh_1). Therefore, the application of an inclination sensor leads to poor results owing to their poor dynamic properties. A set of three gyroscopes are used to compensate their dynamic behaviour. As the integrated angular velocity information of the gyros cannot be computed without drift, a sensor fusion method is used to combine both sensor data from acceleration sensors and gyroscopes to obtain the best performance. The sensor fusion methods often employed for such systems are the drift estimation using a Kalman filter or fusing the information with a complementary filter. (d) Dynamics and control Information on dynamics and control of JOHNNIE is given in earlier publications (Gienger et al. 2000, 2001). We shall focus here on structural problems. Dynamics is modelled by multibody theory, including 71 DOF. The control scheme of the biped robot is structured in three layers. As shown in figure 8, the highest level refers to the global coordination of the gait pattern. For each phase of the gait pattern, the trajectories are generated at the second level. This includes the computation of the step length. Based on these reference trajectories, the computation of the system dynamics and the control of the trajectories are performed at the lowest level. The transition between the gait patterns 'standing', 'walking' and 'jogging' is determined at the highest level. It should be noted that jogging has been realized only by software not by hardware. Theoretically, it is possible to compute an ideal trajectory that satisfies all constraints. Prescribing the trajectories for all joints, it should be possible to keep the system in a stable walking condition. However, practical experiments show that the margin of stability is very small and that even minor disturbances like sensor noise can lead to an unrecoverable system instability. Essentially, the limitation of the foot torques leads to an underactuated system. When the trajectories are prescribed in terms of the joint angles, the overall orientation of the system is not controllable and the robot tips over Phil. Trans. R. Soc. A (2007)</page><page sequence="18">126 F. Pfeiffer Figure 12. Ankle joint actuation. sensor Figure 13. Foot design. while keeping the correct joint angles. In order to stabilize the robot in case of disturbances, we therefore map the underactuated degrees of freedom on coordinates, which are not critical for the system stability. In particular, the position of the centre of gravity is controlled by the foot torques, while the orientation of the upper body is controlled independently of these torques. When the torques reach their limit, the centre of gravity is accelerated, but the overall system does not tip over and remains controllable. When the robot is disturbed, it walks faster or steps to the side, but it does not become unstable. As a trade-off of this scheme, an additional concept is necessary to control the velocity of the centre of gravity. This is done by adapting the step length and the position of the supporting foot in the lateral direction, respectively. By this way, the velocity of the centre of gravity can be brought back to the reference velocity within one step. Phil Trans. R. Soc. A (2007)</page><page sequence="19">The TUM walking machines 127 A V V D ground ref. analogue digital ground " T T T r? Dflot(takt) "H- ^^?t -*DM (daten (12 bit)) z^^^rT^^ ~~iv I i i i i i ^^m ..^JLr*00111 (chiPselect) / (7^^ tpE&gt;--h-r^to"|-^Ain(kanal2) \ \^ bE*JI^-L-[fiitol?Ain (kanal 3) \^^?^&lt;&lt;^^^Lr^l^|i-H-rfilter&gt;#Ain (kanal 4) ^^L^^l^l-flOter&gt;? Ain (kanal 5) L__J&gt;)1-[liter"}-* A^ (kanal 6) Figure 14. Design of the force sensor. 4. Some results (a) Simulations JOHNNIE walks, but has not reached jogging velocities. We use multibody simulations to test the performance of the controller and to optimize the mechanical design of the robot. Particular emphasis is put on the simulation of the contact between the foot and the ground. The foot contacts consist of four cylindrical elements with which the foot can perform a rolling motion at touchdown and lift-off. The contact between these elements and the ground is modelled as a rigid-body contact leading to a complementarity problem (Pfeiffer et al. 1997; Rofimann 1998), which can be solved by well-known standard algorithms. Another important issue is the simulation of the friction of the harmonic drive gears (Rofimann 1998). The friction is modelled with a nonlinear characteristic, while the stick-slip transitions are also implemented with linear complementarity problems. The simulations show that the controller is suitable to generate a stable gait pattern. External disturbances can be handled effectively with the described strategy. The simulation results are used to optimize the design. Figure 15 shows typical simulation results that were obtained in an optimization of the geometric arrangement of the hip joint. (b) Walking experiments Two types of experiments have been carried out: a large number of walking tests on a conveyor belt and some tests where a certain amount of autonomous walking was realized. The robot's speed on the conveyor belt can be adjusted manually by the operator. In addition, the walking direction is controlled in such a way that the machine remains centred on the belt even for long-term experiments. It has been found that the belt acceleration influences the walking stability only to a small extent, allowing therefore a fast transition to the maximum speed of the belt. The walking speed realized by the machine control Phil. Trans. R. Soc. A (2007)</page><page sequence="20">128 F. Pfeiffer joint angular velocities 6r-1-1-1 ? . hip adduction/abduction - |' ' hip flexion/extension ^ 4 I j\ ' ^ hip i^ernal rotation - /\ - 7 "./ \.:.7 , , r \ J , &amp; 9 l J 1 '' ! ^ i ' l'' ! \ L ! ?' ' J S I. 1 i'' I".rjrpTYTYpp-r 1.'i.tfr-j.rfVi.v -6 I-ii?i-.-1 joint torque 1001-1-1-1 : hip adduction/abduction hip flexion/extension : hip internal rotation 50 -./I"""""71./\:"*?\"""/^v,.rt"7rF:7&gt;.n""^./,""" -iso If.ih/-l.'-Ui.jlp."-p _100L-ii-i-1-L_y 0 12 3 time (s) Figure 15. Hip joint velocities and torques for jogging. as presented previously is at the time being limited to 2.2 km h-1, with a maximum step length of 60 cm. A new biped being currently developed will exceed these values. Figure 16 illustrates a walking process on a conveyor belt. The second test including autonomous walking was prepared for the Hannover Fair 2003 and was presented there with the following scenario. Within an area of 5 by 7 m, the robot starts in one corner, comes to an obstacle and decides by itself to step over it. It comes then to a second obstacle, which is too large for the robot, therefore it decides to go around. JOHNNIE then walks around the external limits of the area meeting finally some stairs. It decides to go upstairs to the conveyor belt, where it performs some walking with high speed. The decision capabilities were achieved by a vision system developed by Prof. Giinther Schmidt in Munich (Lorch et al. 2000; Schmidt et al. 2001; Schmidt 2005). The vision results were combined with the walking possibilities of JOHNNIE to realize the appropriate walking process. All decisions for avoiding obstacles and for climbing the stairs were based on an external world model resulting from the vision process. From this JOHNNIE could see, decide and walk without any operator's support. Figure 17 depicts the staircase walking. Phil Trans. R. Soc. A (2007)</page><page sequence="21">The TUM walking machines 129 Figure 16. Walking JOHNNIE. Figure 17. JOHNNIE on stairs. Phil. Trans. R. Soc. A (2007)</page><page sequence="22">130 F. Pfeiffer The author is very much indebted to two supporting institutions, which have helped to develop and to realize the three machines as presented previously, and which have financed the research on walking and walking machines on a general basis. First, I thank the German Research Foundation (DFG) for subsidizing MAX by an individual grant and JOHNNIE within the framework of a Priority Programme. Second, I thank the industrial Korber Foundation for conferring to us their award, which allowed us to realize MORITZ. References Cruse, H. 1976 The function of the legs in the free walking stick insect, Carausius morosus. J. Comp. Physiol 112. Eltze, J. 1994 Biologisch orientierte Entwicklung einer sechsbeinigen Laufmaschine. In Fortschrittberichte VDI, Reihe 17, Nr. 110. Dusseldorf, Germany: VDI-Verlag. Gienger, M. 2005 Entwurf und Realisierung einer zweibeinigen Laufmaschine. In Fortschrittber ichte VDI, Reihe 1, Nr. 378. Dusseldorf, Germany: VDI Verlag. Gienger, M., Loffler, K. k Pfeiffer, F. 2000 A biped robot that joggs. In Proc. 2000 Int. Conf. on Robotics and Automation, San Francisco, USA, pp. 3334-3339. Gienger, M., Loffler, K. k Pfeiffer, F. 2001a Towards the design of a biped jogging robot. In Proc. 2001 Int. Conf. on Robotics and Automation, Seoul, Korea, pp. 4140-4145. Gienger, M., Loffler, K. k Pfeiffer, F. 20016 Design and sensor system of a biped robot. In Proc. 4th Int. Conf. on Climbing and Walking Robots (CLAWAR), Karlsruhe, Germany, 2^-26 September 2001, pp. 205-212. Hahn, U. 1994 Calculation of anthropometric data for human body segments. Implemented in software program Calcman3d. Hirai, K., Hirose, M. k Takenaka, T. 1998 The development of honda humanoid robot. In Proc. 1998 IEEE Int. Conf. on Robotics and Automation, Leuven, Belgium, May 1998, pp. 1321-1326. Kuffner, J. J., Kagami, S., Inoue, H. k Inaga, M. 2002 Dynamically stable motion planning for humanoid robots. Anton. Robots 12, 105-118. (doi:10.1023/A:1013219111657) Loffler, K. 2005 Dynamik und Regelung einer zweibeinigen Laufmaschine, Dissertation Lehrstuhl fur Angewandte Mechanik, TU-Munchen. Loffler, K., Gienger, M. k Pfeiffer, F. 2000 Control of a biped jogging robot. In Proc. 6th Int. Workshop on Advanced Motion Control, Nagoya, Japan, March 2000, pp. 601-605. Loffler, K., Gienger, M. k Pfeiffer, F. 2002 Trajectory control of a biped robot. In Proc. 5th Int. Conf. on Climbing and Walking Robots (CLA WAR), Paris, pp. 437-444. Lorch, O., Denk, J., Buss, M., Freyberger, F. k Schmidt, G. 2000 Coordination of perception and locomotion planning for goal-oriented walking. In Proc. Int. Conf. on Climbing and Walking Robots (CLAWAR), Madrid, Spain, October 2000, pp. 183-192. Neubauer, W. 1993 Locomotion with articulated legs in pipes or ducts. In Proc. Int. Conf. on Intelligent Autonomous Systems, Pittsbourgh, USA, 1993, pp. 64-71. Nishiwaki, K., Sugihara, T., Kagami, S., Inaba, M. k Inoue, H. 2001 Online mixture and connection of basic motion for humanoid walking control by footprint specification. In Proc. 2001 IEEE Int. Conf. on Robotics and Automation, Seoul, Korea, 2001. Pfeiffer, F. 2002 The logic of walking machine control. IF AC-Workshop on Modelling and Analysis of Logic Controlled Dynamic Systems, Irkutsk, Russia. Pfeiffer, F. k Cruse, H. 1994 Bionik des Laufens?technische Umsetzung biologischen Wissens. In Konstruktion, Nr. 46, pp. 261-266. Pfeiffer, F. k Cruse, H. 2005 Autonomes Laufen. Berlin, Germany; New York, NY: Springer. Pfeiffer, F. k Steuer, J. 1999 Design of Walking Machines?Control Aspects, 1999 IF AC, 14th Triennial World Congress, Bejing, China, pp. 413-418. Pfeiffer, F. k Zielinska, T. 2004 Walking?biological and technological aspects, CISM Udine, September 2003. Vienna, Austria; New York, NY: Springer. Pfeiffer, F., Eltze, J. k Weidemann, H.-J. 1995 The TUM-walking machine. Intell Automat. Soft Comput. 1, 307-323. Phil. Trans. R. Soc. A (2007)</page><page sequence="23">The TUM walking machines 131 Pfeiffer, F., Rofimann, Th. &amp;; Steuer, J. 1997 Theory and practice of machine walking, CISM Courses and Lectures, No. 375, Human and Machine Locomotion, pp. 231-281. Vienna, Austria; New York, NY: Springer Verlag. Pfeiffer, F., LofHer, K. &amp; Gienger, M. 2002 The concept of jogging Johnnie. In Proc. 2002 IEEE Int. Conf. on Robotics and Automation, Washington DC, USA, pp. 3129-3135. Raibert, M. H. 1986 Legged robots that balance. Cambridge, MA: MIT Press. Rofimann, Th. 1998 Fine Laufmaschine fur Rohre, Fortschritt-Berichte VDI, Reihe 8, Nr. 732. Diisseldorf, Germany: VDI-Verlag. Rofimann, Th. &amp; Pfeiffer, F. 1996 Control and design of a pipe crawling robot. In Proc. 13th World Congress, Int. Federation of Automatic Control, San Francisco, USA. Schmidt, G. 2005 Perzeptionsbasiertes humanoides Gehen. In Autonomes Laufen (ed. F. Pfeiffer &amp; H. Cruse). Berlin, Germany; New York, NY: Springer. Schmidt, G., Lorch, O., Seara, J., Denk, J. &amp; Freyberger, F. 2001 Investigations into goal-oriented vision-based walking of a biped humanoid robot. In Proc. 10th Int. Workshop on Robotics in Alpe-Adria- Danube Region (RAAD'01), Vienna, Austria, May 2001. Slotine, J.-J. E. &amp; Li, W. 1991 Applied nonlinear control. Englewood Cliffs, NJ: Prentice Hall. Waldron, K. 1986 Force and motion management in legged locomotion. IEEE J. Robot. Automat. RA-2. Weidemann, H.-J. 1993 Dynamik und Regelung von sechsbeinigen Robotern und naturlichen Hexapoden. Fortschrittberichte VDI, Reihe 8, Nr. 362. Diisseldorf, Germany: VDI-Verlag. Yamaguchi, J., Takanishi, A. &amp; Kato, I. 1994 Development of a biped walking robot adapting to a horizontally uneven surface. In Proc. 1994 IEEE/RSJ Int. Conf on Intelligent Robots and Systems, Munich, Germany, pp. 1156-1163. Phil. Trans. R. Soc. A (2007)</page></plain_text>