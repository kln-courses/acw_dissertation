<plain_text><page sequence="1">Appl. Statist. (2009) 58, Part 2, pp. 267-284 A functional approach to diversity profiles Stefano A. Gattone Universita di Roma "Tor Vergata", Italy and Tonio Di Battista Universita "G. d'Annunzio", Pescara, Italy [Received February 2007. Final revision September 2008] Summary. Diversity plays a central role in ecological theory and its conservation and man agement are important issues for the wellbeing and stability of ecosystems. The aim of this work is to provide a reliable theoretical framework for performing statistical analysis on eco logical diversity by means of the joint use of diversity profiles and functional data analysis. We point out that ecological diversity is a multivariate concept as it is a function of the relative abundances of species in a biological community. For this, several researchers have suggested using parametric families of indices of diversity for obtaining more information from the data. Patil and Taillie introduced the concept of intrinsic diversity ordering which can be determined by using the diversity profile. It may be noted that the diversity profile is a non-negative and convex curve which consists of a sequence of measurements as a function of a given parame ter. Thus, diversity profiles can be explained through a process that is described in a functional setting. Recent developments in environmental studies have focused on the opportunity to eval uate community diversity changes over space and/or correlation of diversity with environmental characteristics. For this, we develop an innovative analysis of diversity based on a functional data approach. Whereas conventional statistical methods process data as a sequence of indi vidual observations, functional data analysis is designed to process a collection of functions or curves. Moreover, unconstrained models may lead to negative and/or non-convex estimates for the diversity profiles. To overcome this problem, a transformation is proposed which can be constrained to be non-negative and convex. We focus on some applications showing how functional data analysis provides an alternative way of understanding biological diversity and its interaction with natural and/or human factors. Keywords'. Biological population; Diversity index; Diversity profile; Functional data analysis; Intrinsic diversity ordering; Smoothing splines 1. Introduction The concept of diversity arises in both ecological and non-ecological disciplines (Hart, 1971; Pielou, 1975). Diversity is related to the apportionment of some quantity into a number of cate gories. In an ecological framework, the diversity concept relies on the variety of living organisms in a delineated study area. In past years, global changes such as deforestation and pollution have highlighted the issue of preserving the diversity of ecological communities, and evaluation of biodiversity has become a crucial element of environmental monitoring programmes (McCann, 2002). As a consequence, a huge number of indices of diversity have been developed to quantify biological diversity and to assess the biological health of a given community (Gove et al., 1994). For environmental monitoring and protection, the aspect of interest may not be just the Address for correspondence'. Stefano A. Gattone, Dipartimento di Studi Economico-Finanziari e Metodi Quan titative Universita di Roma "Tor Vergata", Via Columbia, 2-00133 Roma, Italy. E-mail: gattone@economia.uniroma2.it ? 2009 Royal Statistical Society 0035-9254/09/58267</page><page sequence="2">268 S. A. Gattone and T. Di Battista 0.451-.-.-1 2.6 r-.-r-. 131-.-r-| 0.4 I 2.41 12 22 11 0,35 I ' 10 0.25- 1 1 8 tf \ tq 1-6" \ - ? 0.2 - \ \ 7 " \ 1.4- \ 0.15 h \ " \ \ 1'2 \ 5 \ I \ 4I \ 0-05 \ - o.8 [ \ ' 3r \ 0'-'--^ 0.6'-'-J 21:-^~?- -I 0 5 10 0 50 100 0 50 100 (a) (b) (c) Fig. 1. Lesina lake data: (a) intrinsic 7&gt;, (b) Renyi Hr and (c) Hill Nr diversity profiles diversity itself but to understand the interactions between diversity and environmental stress gradients. One might be interested in evaluating how much of the landscape variation of diver sity is associated with changes in sample composition along an environmental gradient. For example, dividing the study region into q habitats (e.g. grassland, scrub and lowland forest), the goal of the analysis could be the study of the pattern of diversity in each habitat. An impor tant application could be the study of the statistical relationship between diversity and some given environmental variables expressing habitat characteristics (Moncreiff and Perrin, 1979). The resulting model should depict the complex influence of each environmental variable on the diversity of a given community. Finally, another aim of the researcher might be to predict diversity from a set of covariates (see, for example, Lek-Ang et al (1999)). Several studies have been conducted which relate diversity to environmental changes. Almost all of these have the potential shortcoming that they use only one single index of diversity in the analysis so any association that is observed is dependent on the measure of diversity that is adopted. For instance, in a study on the relationship between environmental diversity and genetic variation, Taylor and Condra (1979) showed that correlations between ?0.64 and 0.69 could be obtained, depending on how diversity is measured. Indeed, ecological diversity is a multidimensional concept accounting for both species richness (the number of different spe cies) and species evenness (the relative abundance of different species), and the use of a single index greatly reduces the complexity of the ecological systems. As a consequence, measures of diversity are problematic because they may lead to different ordering of communities in terms of their diversity. This means that results of comparative studies may depend on the selected index of diversity and on which particular aspect of diversity we are interested in. In fact, each index of diversity incorporates a particular degree of sensitivity to rare and common species. A solution is given by the use of parametric families of indices of diversity (Hill, 1973; Patil and Taillie, 1982; Tothmeresz, 1995; Liu et al., 2007), which are usually referred to as diversity profiles, which consist of a sequence of measurements allowing different aspects of community</page><page sequence="3">Diversity Profiles 269 structure to be encompassed in a single diversity spectrum. As shown in Fig. 1, which shows an example of a plot of three different diversity profiles of a biological community, the diversity profile is a curve unlike an index of diversity which is a scalar. This emphasizes the importance of using such an approach in environmental studies as it does not collapse the information of a multidimensional set (the biological community) into a single number. To prevent inconsistencies when the diversity of two communities is compared, an index of diversity should have some desirable properties (Pielou, 1975) which make the profiles non-nega tive, monotone decreasing and convex functions over the domain. As a consequence, modelling diversity profiles is not always straightforward. In particular, standard linear models may not provide valid estimates of diversity profiles as their output may exhibit undesirable features such as being negative and/or not convex. Our application concerns a study that was conducted on the Lesina lagoon (Italy), where to assess the quality of the ecosystem we investigated the relationships between the diversity of the benthic community of the lagoon and the chemical physical characteristics of the site. The standard multivariate linear regression model may fail to fit, leading to diversity profile estimates with negative values or to profiles that are not convex. Such undesired output would preclude prediction intervals and tests of hypotheses. To achieve desirable estimates, we propose to analyse diversity profile along the lines of func tional data analysis (FDA) (Ramsay and Silverman, 2002, 2005). The central idea is to replace the vector description of community structure given by the diversity profile by functional units. In this framework, observed data are represented by a collection of functions or curves. The FDA approach provides analytical tools that are suitable to preserve the non-negativity and convexity of the estimates of the resulting diversity profiles. By transforming diversity profiles to a functional form we move from a constrained to an unconstrained problem. In this way, func tional linear models and functional analysis of variance (FANOVA) can be applied to analyse the interactions between biological diversity and environmental gradients or human activities which may differ spatially and temporally. In Section 2 we briefly review measures of diversity and methods of diversity ordering. The use of FDA to deal with diversity profiles is presented in Section 3. In Section 4 we briefly discuss FANOVA and the functional linear model. In Section 5 we focus on two applications in which the methodology proposed could be used for analysing diversity of biological populations. Section 6 offers some concluding comments. 2. Ecological diversity measures Imagine a community that is partitioned into s species where Ni is the number of individuals belonging to the /th species (1=1,2,.. .,s). Hence N = (N\,N2,.. .,NS)T denotes the abun dance vector whereas p = (p\, p2,..., ps)T represents the relative abundance vector where p\ = Ni/Esi=lNi represents the proportion of biological units belonging to the /th species such that 0^/7/^1 and T,si=lpt = 1. The essential requirements of an index of diversity, say /, are as follows: / must be greater than or equal to 0 and equal to 0 only when pi = 1 for one species; / takes its maximum when p\ = 1 /s for / = 1,2,..., s; I must be an increasing function of s. The simplest measure of diversity is species richness, i.e. the number s of species in a community. Widely applied in ecological studies is the entropy or Shannon index that was derived within the framework of information theory (Shannon, 1948) and defined as s hh = - E Pi log(pi) i=l which ranges from 0 to log(s). An alternative measure of diversity is given by the Simpson index</page><page sequence="4">270 S. A. Gattone and T. Di Battista h = l-tPi 1=1 which assumes values between 0 and (s ? \)/s. The most frequently used indices of diversity depend on the unknown relative abundance vec tor p, say / = /(p). Accordingly, the problem lies in estimating p by means of a suitable sampling design and consequently estimating / as a function of the estimated species abundance vector (Barabesi and Fattorini, 1998). In view of the inadequacy of a single index, several parametric families of diversity indices have been developed for diversity ordering. Renyi (1961) extended the concept of Shannon's entropy by defining a generalized entropy of order r as Hr(^) = j^log(tpIi) r^&lt;Wl. (1) For r = 1, Hr is not defined but, as r ? 1, Hr -&gt; /sh whereas, for r ? co, Hoq -&gt; ? log(/?max). Hill (1973) starting from equation (1) defined his index of diversity of order r as / s \ 1/(1-0 tfr(p)=(?tfj (2) Forr = 0, No = s, for r= \,N\= exp(/sh)&gt;f?rr = 2, #2 = 1/11 - Is\ and,forr-&gt;-oo, Nr-&gt; l//?max. Patil and Taillie (1982) proposed the family of average species rarity indices, i.e. /(P) = EP*) (3) i=i where R(pt) is a suitable measure of rarity for species /. Some of the most frequently used indices of diversity are special cases of equation (3). For example, Shannon's index is obtained from equation (3) if R(pi) = \og(pt). By using a rank-type rarity measure of type R(i) = 1 if r &gt; / and R(i) = 0 if r &lt; /, the right-hand tail sum family of indices of diversity is obtained, where Tr(p)= ? P(i) r = 0,l,...,j-l (4) i=l+r represents the cumulative relative abundance of the s ? r rarest species where P(i) &gt; P(2) ^ ^ P(S) are the relative abundances ranked in descending order and, obviously, Ts ? 0 and To = 1. A plot of Tr, Hr and Nr evaluated on the biological community of Section 5.2 is given in Fig. 1. We can generalize the formulation of a parametric family of indices of diversity as {Pr: r e B} where Pr are various diversity measures obtained by varying r in the domain B which can be finite or infinite. The curve which joins with line segments the (r, Pr) pairs for r e B is termed a diversity profile, which depicts in a single picture simultaneous values of diversity measures with varying sensitivities to the rare and abundant species as a function of the parameter r. Moreover, the diversity profile plays a fundamental role when we are interested in comparing the diversity of different communities in time and space. For this, Patil and Taillie (1982) introduced the concept of intrinsic diversity ordering where a community C\ with relative abundance vector p is defined as intrinsically more diverse than a community C2 with relative abundance vector q if C\ can be obtained from C2 through a finite sequence of the following operations: (a) transferring abundance from more to less abundant species without reversing the rank order of the species; (b) transferring abundances to a new species; (c) relabelling species.</page><page sequence="5">Diversity Profiles 271 Consequently, they proposed use of the Schur concavity property of a function (Marshall and Olkin, 1974) to examine whether an index of diversity satisfies these three requirements./ is Schur concave if /(p) ^ f(q) holds whenever p &gt;- q, where vector p is said to majorize vector q, in symbols p &gt;- q, if s s k k Z&gt;i = E# and EW)^E?0? Vk&lt;S. 1=1 1=1 1=1 1=1 Tong (1983) has proved that if a function /(p) is Schur concave then it will preserve the ordering whenever there is an intrinsic diversity ordering between two communities. He has also verified that the diversity profiles in expressions (1), (2) and (4) are Schur concave. Therefore, if any intrinsic diversity ordering exists, the diversity profiles Hr, Nr and Tr will give the same result in ranking the diversity of communities. The mathematical property of being Schur concave makes the diversity profiles non-negative, monotonically decreasing and convex functions. These fea tures lead to the problem of how to obtain a good estimation and/or prediction while leaving the diversity profiles constrained as desired and to justify the functional approach that is described in the next section. 3. Functional diversity profiles Let us suppose that abundance data have been collected from a biological community. For each environmental sitey our observation is the diversity profile {Pjr: r e B}, for j = 1,2,..., n. We may think of our data as a sample of smooth curves which can be considered as indepen dent realizations of an underlying biological process. FDA represents the diversity profile as a functional on the set B leading to the non-parametric regression model Pjr = fj(r) + sjr reB, j=\,...,n, (5) where f(r) is an arbitrary smooth function and s denotes an unknown independent zero-mean error term with variance o2. As the parameter r varies in B each curve fj(r) corresponds to an underlying pattern of diversity. A common approach to modelling functional data is to convert the raw sampled data points {Pjr :reB} into the continuous functions fj(r) based on basis function expansion and smoothing (Ramsay and Silverman, 2005). There is no best choice of the basis function as the choice depends on the data at hand. We choose to use the spline basis because of its flexibility and easy implementation (Wegman and Wright, 1983). The difference with respect to other physical processes is that real samples of curves of diversity profiles have a similar and regular shape as they are non-negative, convex and decreasing. Thus, we need to place some restrictions on fj(r) to fit model (5). In particular, in choosing/ we want to preserve convexity and non-negativeness to model the diversity profile. Wright and Wegman (1980) described an approach to fitting convex interpolation splines. They proposed use of the convex function 01 W= / \ I (/)(u)du&gt;dx where cf)(u) = exp(w). Suitably scaled translations of &lt;j)\(r) will give a function/ in model (5) with D2/(r) ^ 0 where the notation Dm denotes the operation of taking the derivative of order m for m &gt; 0. Similarly, Ramsay (1998), with the purpose of smoothing data with a function that satisfies certain constraints, proposed the representation</page><page sequence="6">272 S. A. Gattone and T. Di Battista f = p0 + PiV-{m-l)exPnw) (6) where /?o and (3\ are arbitrary constants, D_1 means taking the indefinite integral and w is a Lebesgue square integrable function. In particular,/ is the solution of the differential equation Dmf = w Dm~lf. It is straightforward to verify that for m = 1 the solution is a positive function, for m = 2 the solution is a monotone function and for m = 3 the solution is a convex function. We are interested in the operator M(r,w) = D-2exp{D_1w(r)}= j f expj / w(u)du \ \dtdx, which may be termed the convexity operator, which operates on the function w to render it convex. Function w is expanded in terms of K known basis functions, namely w = cT(/&gt; (7) where c is the coefficient vector defining the linear combination and &lt;/&gt; is the vector (4&gt;\, 02,..., &lt;/&gt;a:)t of basis functions. According to the parametric model (5) the fitting criterion is obtained by adding to the usual goodness-of-fit term a roughness penalty term (Green and Silverman, 1994) so that the objective function to minimize is set to LPEN(P, /, A) = ? {Pr - f(r)}2 + A f w2(u) Au (8) reB JO where f(r) has the form that is given in equation (6) and A ^ 0 is a smoothing parameter. It is well known that the solution of equation (8) is given by a piecewise polynomial spline of degree 3 with knots positioned at parameters values reB (Silverman, 1985). The first term of equation (8) indicates the lack of fit off to the data whereas the second measures the degree of smoothness off and is therefore a roughness penalty. The smoothing parameter A ^ 0 controls the trade-off between smoothness and fit, since the coefficient function w measures the relative curvature off. The choice of the smoothing parameter A is an important step in the fitting process. Generally, cross-validation (Craven and Wahba, 1979) is the method that is used to estimate such a param eter automatically, where the choice of A is then the value that minimizes the cross-validation function CV(A)=?{/A-'(r)-/&gt;r}2, reB where /j^(r) is the smoothing spline that is calculated from equation (8) with the pair (/, P;) omitted. By imposing the constraints /?o = Po and f3\ = (D-2 exp[D_1 w{max(r)}])-1 we ensure the non-negativeness off and in particular that f(0) = Po and /{(max(r)} = Pmax(r), as for the diversity profiles. In this way the function/ depends only on the coefficients w(r) = cT &lt;f)(r) and our task is to find the coefficient vector c which minimizes the cost function LPEN. This can be done by means of the Gauss-Jordan procedure for non-linear least squares problems (see Ramsay (1998) for details). Once we have reconstructed the profile one by one, we have filtered out the disturbance or error term e in model (5). The main result of transformation (6) is that we can overcome the problem of finding the constrained functional f(r) by estimating the unconstrained function w(r) that, in what follows, we shall term the unconstrained diversity profile. The function w(r) has the same information on diversity off and consequently of {Pyr :refi},soon w(r) we can implement functional linear modelling with the knowledge that whenever it is required we can</page><page sequence="7">Diversity Profiles 273 invert the transformation and go back to the constrained diversity profile functions by putting the coefficients w in expression (6). 4. Functional linear models for diversity profiles Functional linear modelling is designed for situations in which the response is a smooth real function and the design matrix is not modified with respect to the classical general linear model. Let us suppose that the functional responses Wj(r) that are defined in equation (7) arise from the model w = Z/3 + e (9) where /3 = ((3\(r),..., (3q(r)) is a #-vector of functions expanded by the same basis of w with the form (3 = L0 for a suitable q x K matrix of coefficients L. e = (s\ (r),..., sn (r)) is a vector of n residual functions. The n x q matrix Z can have the same structure of the design matrix as in multivariate one-way analysis of variance, or alternatively can be a matrix of covariates as in the conventional multivariate general linear model. In the first case, we may consider the methodology in terms of FANOVA where diversity profiles are evaluated on a number of environmental sites subdivided into q different habitats. The model for the ?th unconstrained diversity function in the hth habitat could be wkh(r) = fi(r) + ph(r) + ?kh(r). (10) o. ^-- -1 ?r^\~-1 ?n^T-"-1 ?H\^-"-1 _-2 &gt;s. -2 ^\ -2 ^x. -2 ^\ T-4 ^&gt;-^ -4 ^^-^ -4 ^^^^ -4 ^^-^: -6 -6 -6 -6 0 20 20 20 2 ?r\r?'?i ?i \? ?i ?n\-1 ?r\- ?i _-2 \ -2 ^v -2 &gt;v -2 ^n. ?-4 ^x^_ -4 ^x-^ -4 ^x^^ -4 ^^\X -6 -6 -6 -6 0 20 20 20 2 Op--1 Op-? -1 Op-? -1 Op-- -1 _-2 ^v -2 ^x. "2 ^s. -2 ^\ V-4 ^x. -4 \s. -4 X, -4 \. -6 ^&gt;^ -6 ^^^ -6 ^^- -6 ^"^ 0 20 20 20 2 Op- -1 Op- - -1 Op- -1 Op- - -1 ^-2 \ -2 \ -2 V -2 \ ?-4 \ -4 \ -4 \. -4 \ -6 ^^_ -6 ^&gt;^_ -6 ^-^____ "6 X^^ 0 20 20 20 2 r r r r Fig. 2. Unconstrained diversity profiles w(r) of data of Section 5.1: data (.) and FANOVA model predictions (-), corresponding to R2 = 0.9471</page><page sequence="8">274 S. A. Gattone and T. Di Battista 12 |-r-.-.-1 5 6 " I \'\ 0I-1-. 0 2 i) ?r^s^~- - - ^ ' * * *, -5- v^ "-.... -6- """" _7I-,-, ' . 0 2 r (b) Fig. 3. Data of Section 5.1: (a) Hill's diversity profiles and (b) unconstrained diversity profile for the four treatment groups (-, treatment 1; 111111, treatment 2; - - treatment 3;-,., treatment 4) The function p, indicates the average of the unconstrained diversity profiles across the entire region under study, i.e. the mean of the sample data 1 n M0 = - ? Wk(r). "*=l The terms Ph(r) are the specific effects on diversity of being in habitat h. The residual function 6kh(r) is the unexplained variation that is specific to the A:th environmental site within habitat</page><page sequence="9">Diversity Profiles 275 h. Within this framework, the matrix Z of model (9) is defined as an n x (q+ 1) design matrix with one row for each environmental sampling site. Once the diversity effect for each habitat has been modelled, the next step of the analysis is to assess whether there is evidence that the unconstrained diversity profile w(r) is affected by the habitat. Alternatively, if the aim of the analysis is to relate diversity to a set of q environmental covari ates, the matrix Z of model (9) becomes a matrix of explanatory variables and (3 is the ^-vector of regression functions. A straightforward solution of the general linear model (9) could be obtained (Ramsay and Silverman, 2005) by finding L which minimizes the fitting criterion / {w(r)-Zf3(r)}2dr. JreB The least squares solution L provides the estimated parameter vector J3 = L0 which substituted into equation (9) gives us the values w = Z/3 predicted by the model. By substituting w in equa tion (6) we end up with the predicted diversity profile / as defined in Section 3. The assessment of fit can be judged by using an overall R2-measure that is given by the squared correlations / th(r)2dr r,2 i JreBk=\_ ~7?" T~' / ?{%W-/i(r)}2dr JreBk=l 3r 2r 1.5 2 V ^S_ 0.5 \. 0I-,-,-__, 0I-,- .-;. .- . , 0 2 0 2 (a) (b) 1r Or 0.5 yS S \ S '/:' 0 \^_. /' - .,,...-?? _3' ;; _0.5'- - - -4'- - - 0 2 0 2 r r (c) (d) Fig. 4. Data of Section 5.1: estimated treatment diversity effect $h(r) (-) together with a point wise 95% bootstrap confidence interval (.) for the unconstrained diversity functions for the model Wktkr) = P(r) + 0h(r) + ?kh(r), for (a) h = 1, (b) h = 2, (c)h = 3 and (d) h = 4</page><page sequence="10">276 S. A. Gattone and T Di Battista Moreover, the significance of the functional effect (3 can be assessed by testing Ho: /3(r) = 0 at each specific value r e B by using the F-ratio in analogy with the standard linear model MSR(r) FW=MSEW' (H) where MSR and MSE are the mean-square regression and the mean-square error functions respectively. As the F-ratio F(r) is dependent on the value r, it becomes a functional. When the regression errors ?kh (r) are assumed to be independent random variables from a normal distri bution with zero mean and constant variance a2, then the F-value F(r) can be compared with critical values from the F-distribution with q ? 1 and n?q degrees of freedom to see whether it is significantly large. If this is so then there is evidence that the unconstrained diversity w(r) is affected by some variable in matrix Z. Otherwise, a randomization procedure could be followed to obtain the distribution of the F-values under the null hypothesis that Ho:/3h(r)=0 (Manly, 1997). One question that is not solved here is an overall assessment of significance of the habitat diversity effect for all values of the parameter r. A possible solution is given in Di Battista and Gattone (2003) where simultaneous inference was performed in a two-sample problem. Unless we can propose a suitable parametric model for the mean and the covariance of the diversity profiles, the bootstrap methodology (Efron and Tibshirani, 1993) could represent a practical alternative to derive confidence bands or hypothesis tests. In particular, the bootstrap approximation to the distribution of the least squares estimator can provide pointwise con fidence intervals for the functional effect /3 (Faraway, 1997). Let ?\(r), 62(f),...,?n(r) denote the estimated residuals. Generate pseudodata w* = (w* (r), w* (r),... w* (r))T, from the formula w* = Z/3 + e* where ?* is obtained by resampling residuals from the {st (r): i = 1,2,..., n}. Recompute the statistic /3 from the pseudodata to obtain a bootstrap replication of the regres 45 r 40 1\ 351 \ 30 h \ DT 25 I ^_^^^^ 20 I 15 h 5'. . . .'.'.'.'.'.'.' 0 2 r Fig. 5. Data of Section 5.1: F-ratio function F(r) (., 1 % level of significance for the F-distribution with 3 and 12 degrees of freedom)</page><page sequence="11">Diversity Profiles 277 X Mare Adriatico ??v__^^ Canale ^*-^?, ^lf\ Schiapparo ^~^^\s^s \ Canale \ \. ^?^^~^ r'M / Acquarotta\ -- _/ j^ &lt;-^'rVX^ r-^_^w?^"?^^^^ 18 ?19 ?21 '?25 J I -r-^?~^~ #23 y / ?2 .3 ?6 ?8 "13 *22 / \Laao di Lesina z'11 #1T ,2? / 1 *4 / \ 14,16_^/^^x~^ Lesina Fig. 6. Study area and location of sampling stations in the Lesina lagoon, Apulia, Adriatic sea sion coefficients (3 . Repeating these steps M times we obtain the empirical bootstrap distri bution of /3. Finally, by means of the empirical quantiles of the bootstrap distribution we can form a confidence interval for (3. 5. An application 5.1. A mesocosm study For illustration, we briefly consider a previously analysed (Smith, 1998) data set that was col lected in a mesocosm study in which n = 16 biological populations were assigned toq = 4 treat ments to compare the effects of various doses of pesticide on the abundance of each biological population. The data consist of abundances of 12 species in each population. Further details of the data may be found in Smith (1998). Diversity was evaluated by using Hill's diversity profile Nr that was defined in equation (2). For each biological population the profiles were calculated with r values on an evenly spaced grid of 15 points from 0 to 2, as for r close to 2 the profiles reach their minimum value l//?max. From Nr we obtain the unconstrained diversity profiles w(r) by using transformation (6). Finally, the FANOVA model of equation (10) was applied to w(r) to test the hypothesis of no treatment effect on diversity. Fig. 2 shows both data and model predictions for which P2 = 0.9471. Fig. 3 displays the unconstrained estimated diversity profiles w(r) for the four treatment groups and the corresponding constrained profiles that were obtained by putting w(r) in equation (6). In Fig. 4 the treatment diversity effects $h (r) of model</page><page sequence="12">278 S. A. Gattone and T. Di Battista --1-1-1-1-1-1 0.4 *^&gt; 12 3 4 5 6 7 8 (a) _-,-,-,-,-,-, 0.4 &lt;\ 0.3 ^J\\ 1 2 3 4 5 6 7 8 r (b) Fig. 7. Lesina lake data: comparisons of diversity profiles predictions from (a) the standard multivariate linear model and (b) the constrained functional linear model (10) are plotted together with a pointwise 95% confidence interval that was obtained by using the bootstrap procedure of Section 4. Note that the effects are required to sum to 0 for each spe cies r. Finally, we assess the significance of the model by evaluating the F-ratio at each value r. Fig. 5 shows the F-ratio function (11) together with the 1% level of significance for the F-distribution with 3 and 12 degrees of freedom. We can see that the F-ratio is clearly above the critical value so we can conclude that there is a substantial effect of the treatments on the diversity of the four biological communities. In particular, diversity decreases from treatment 1 to treatment 4, confirming the results of the randomization test on relative abundances that was performed by Smith (1998). 5.2. Lesina lake data The functional linear model has been applied to the benthic community of Lake Lesina (Italy). Lesina lagoon is in southern Italy on the northern coast of the Gargano promontory (Apulia), bordering the Adriatic sea (Fig. 6). The basin is characterized by a surface area of 51 km2, an average water depth of 0.8 m and a maximum depth less than 2 m. Two channels connect the lagoon to the Adriatic sea, and freshwater inflow is ensured by several small rivers in the south-eastern area which lower the salinity from 3.5% to 0.85%. The lagoon is characterized by unstable ecosystems in which living communities are subjected to the influence of natu ral and anthropomorphic effects. Features of the lagoon ecosystem are the large variation in temperature, salinity and dissolved oxygen values. To assess the lagoon ecosystem quality, a study was conducted which combines the chemi cal-physical characterization of the site with the structure of its benthic communities. The lake was divided into 300 quadrats, and 30 of them were sampled with replacement. Sediment was</page><page sequence="13">Diversity Profiles 279 0.2 r I 0.1 CD 0 CO o 0.05 - 0 -0.051-'-'-'-'-'-' 12 3 4 5 6 7 8 species rank Fig. 8. Lesina lake data: regression functions f3(r) for the unconstrained diversity profiles (-, salinity; -, REDOX potential) Table 1. Lesina lake data: p-values of the randomization test on the F-ratio and for the hypotheses H0: /3h(r) = 0, h = 1, 2t Species /3\ /?2 F-test rank I 1 0.033 0.026 0.034 2 0.052 0.024 0.036 3 0.081 0.020 0.041 4 0.113 0.016 0.038 5 0.118 0.014 0.035 6 0.097 0.014 0.033 7 0.088 0.016 0.024 8 0.086 0.017 0.034 tA is the effect of the REDOX potential; fa is the effect of salinity. extracted up to 20 cm depth with a total volume studied of 4500 cm3. All samples were sorted under a microscope and all the organisms were counted, weighed (biomass) and identified for taxa. On each occasion, surface water temperature, salinity, dissolved oxygen concentration, acidity and reduction-oxidation (REDOX) potential were measured. In a previous study (Di Battista and Gattone, 2004) the same survey was studied to estimate confidence intervals for the abundance vector of the benthic communities. In this application we are interested in studying the effect of environmental gradients on the benthic community diversity evaluated by means of the intrinsic diversity profiles Tr that were defined in equation (4). A straightforward approach would be the standard multivariate linear regression model T = Z/3 + e (12)</page><page sequence="14">280 S. A. Gattone and T. Di Battista where T is the matrix of diversity profiles, Z is the matrix of explanatory variables with dimen sion 29 x 5 and (3 is the matrix of regression coefficients. As already noted in Section 3, this model is not guaranteed to produce convex and non-negative profiles. For this reason we choose to represent T by using expression (6) and, consequently, to model the functional parameter w(r) rather than the diversity profile. Our task is made simpler by the fact that w(r) is uncon strained in any way, unlike T which must be non-negative and convex. In Fig. 7 we compare 10 out of 29 model predictions that were obtained with the conventional linear model (12) and the functional linear model (9) and transformation (6). We note that the conventional linear model predictions do not fulfil the non-negativeness and convexity constraints, unlike the constrained estimator that is based on the functional linear model. Moreover these imperfections result in a worse fit as R2 improves in going from R2 = 0.3591 for the unconstrained conventional linear model to 0.5069 for the more powerful constrained functional linear model. The evaluation of the P-ratio function for the full model (9) gives no significant results, providing no evidence of any linear relationship. By using the backward elimination procedure we end up with only two dependent variables, REDOX potential and salinity, with significant results both in terms of overall assessment of the model (P-ratio function) and in terms of the covariate effects /?/*(r). In Fig. 8, the regression functions Ph(r) of the functional linear model (9) on the unconstrained diversity profile W are plotted as a function of rank r. To test the hypothesis that (3h(r) = 0 for h = 1,2 and r = 1,2,..., 8, we evaluate the randomization distribution of the Studentized sta tistic th(r) = Ph(r)/SE0h(r)}, where SE{/3h(r)} denotes the estimated standard error of (3h(r), by randomly reallocating the W-values to the set of Z observations (Manly, 1997). The results of the randomization tests are summarized in Table 1, where/7-values of the test statistic th(r) and the P-test are given. In particular we note that the effect of the variable REDOX potential 1 - I-1 ?4 3 i z*~ i1 ?-8 r i??i i *?-^ _ i i "i_ i-1-1_ I ! ? ' I-1 I I S0-6" i??i ! ri - o?-5- h I v\ I i i?i?. i??i ? n i i | ?-i i m ?-4~ l ! I I I 0.3- | JL j | I 0.2- I I I M fl l"l 4 ^ 111 i 1111111111111 n 111111 ll 18 28 2 15 19 21 29 1 6 4 5 27 3 13 12 7 8 17 20 22 23 24 25 26 9 10 11 14 16 Sampling stations Fig. 9. Lesina lake data: results of the cluster analysis based on the abundance data (group 1, low level of diversity; group 2, intermediate level of diversity; group 3: high level of diversity)</page><page sequence="15">Diversity Profiles 281 Table 2. Mean and standard deviation of the REDOX potential and salinity at the three clusters Environmental variable Cluster I (5 sites) Cluster II (9 sites) Cluster III (15 sites) Salinity 21.4 ?0.89 23.66 ?4.5 24.60 ?5.79 REDOX potential -166.20? 14.22 -126.55?74.10 -144.33?53.50 on diversity is significant for only the two highest ranks. In contrast, the effect of salinity is significant for all the values of the species ranks. This is an important result which shows how our approach allows a simultaneous analysis of all the aspects of diversity. To understand better the link between the community structure and environmental variables, cluster analysis was applied to the abundance data by using Bray-Curtis similarity measures after square-root transformation (Clark and Green, 1988). Hierarchical clustering allows separation of three groups along the lagoon (Fig. 9). The first cluster includes five sites that are affected by freshwater inflows from minor rivers in the central area. The second cluster corresponds to sampling stations in the central area of the lagoon. Finally, the third cluster is composed mainly of sampling stations that are characterized by high seawater inflows with locations near two artificial canals which join the lagoon to the sea. In Table 2 we report the mean values of salinity and REDOX potential at the three clusters. Increasing values of salinity and REDOX potential caused by a progressive reduction of freshwater input are observed. To show the pattern of diversity along the clusters, model (10) has been applied on the three clusters. R2 for the fit was 2r 1.5 - , ' &lt;-.-/*/m lmim " t3 / . ' " " .. I 0.5- +S I *V^,,,,,W""M///// e #VX ""niiiiMnniiiiiiiiiH1.""""mi | 0;? " ' " _2 I-'- ?-1-1-1-1_i_i_i 0 8 species rank Fig. 10. Lesina lake data: estimated cluster diversity effect $h(r) for the unconstrained diversity functions together with a pointwise 95% bootstrap confidence interval (.) for the model wkh(r) = ii(r) + /3h(r) + ?kh(l)&gt; h = 1,2,3 (-, cluster 1;., cluster 2;i i i, cluster 3)</page><page sequence="16">282 S. A. Gattone and T. Di Battista 0.6570. In Fig. 10 the cluster diversity effects /3h(r) of model (10) are plotted together with a pointwise 95% bootstrap confidence interval. In particular, cluster 3, which is characterized by high seawater inflows, turns out to be the most diverse community. Cluster 2 corresponds to an intermediate level of diversity, whereas cluster 1 has the smallest level of diversity. Formal significance tests for differences of profiles among clusters were performed by evaluating the P-ratio (11) on model (10). Results showed very high values of the P-ratio function with signifi cance levels always less than 0.01. Judgement and comparisons of diversity can be done only if the habitats are the same and, moreover, if the species that are present are the same. In this study, we specify that the species that were encountered are almost the same at all the sites except for three rare species. Thus, the clusters correspond to a gradient of decreasing diversity along the same ordering that was obtained with the environmental variables (III &gt;- II &gt;-1), confirming the results of the functional linear model. In conclusion, this study demonstrated a diversity gradient for the benthic communities of the Lesina lagoon which can be related to changes in environmental characteristics. 6. Concluding remarks To our knowledge, no field studies have so far used the tool of diversity profiles to model and interpret the relationship between biological community and environmental factors. Although FDA has been widely developed in recent years, the aim of this work is to develop a functional approach within the context of diversity profiles to provide a reliable theoretical framework for analysing ecological diversity. Two points of view of the functional approach have been con sidered. First, the FANOVA model has been applied to evaluate the change in diversity due to a habitat effect. Then, the functional linear model with diversity as the response variable from a set of environmental covariates was also considered. In both cases, the constrained problem that is associated with diversity profiles demonstrates the need for the FDA approach to study habitat diversity and/or its dependence on any given environmental factor. To ensure desirable properties, ecological theory places some restrictions on the shape of the diversity profile functions. Indeed, the property of Schur concavity of the diversity profiles leads to non-negative and convex functional forms. Hence, they should be estimated with a regression function that preserves these characteristics. This task can be approached in many ways. In the literature, isotonic regression (Barlow et al, 1972) was one of the first attempts to incorporate monotonic restrictions into the estimation of regression functions. The estimation of concave regression functions has also been considered (Mammen, 1991). The general solution is given by constrained least squares regression, where the fitted values are obtained by the usual least squares under a set of inequality constraints. The algorithms can be computationally intensive and involve a large set of inequality restrictions and require a spatial structure of the support. Much work has been devoted to constrained non-parametric regression within the context of smoothing splines. Constraints are usually placed on the coefficient of the basis function (Elfving and Anderson, 1988; Ramsay, 1988). Dole (1999) discussed monotone and concave estimators by using least squares and smoothing splines in the one-dimensional covariate case. However, no attempt has been made so far in the ecological literature to impose shape restric tions on the regression functions of diversity profiles. In this paper, we adopted a different method that was proposed by Ramsay (1998), which appears to be very useful as it can be easily formulated in the context of simple linear models. Moreover, it can be applied to multidimen sional regression functions and adopted for any measures of community diversity represented by a curve (Rousseau et al, 1999). This method does not solve the least squares problem, but it imposes shape restrictions by a functional transformation which moves the constrained problem</page><page sequence="17">Diversity Profiles 283 to an unconstrained problem. In this way, we can rely on a wide set of tools such as FANOVA and functional linear models in the context of diversity profiles, which otherwise could not be appropriate when using the conventional multivariate regression methods that are based on the unconstrained estimator. We have seen in the application that the functional approach ensures a better fit but, more importantly, we would argue that any violation of the given constraints such as those produced by the unconstrained estimator is potentially much more damaging than its effect on R2. However, it is important to note that linearity could be too restrictive for modelling diversity. Although the emphasis was on linear models, the technique that is proposed here has the additional advantage that it can handle a variety of non-linear models and any statistical tool that is suitable to analyse a sample of curves (Kneip and Gasser, 1992). The main contribution of this paper is the use of diversity profiles integrated with a functional approach to allow more flexible model building in studies on ecological diversity. Acknowledgements Our special thanks go to two referees for their constructive comments, which greatly improved the manuscript. We are also very grateful to Professor Richard J. Martin for his useful comments and for improving the English. References Barabesi, L. and Fattorini, L. (1998) The use of replicated plot, line and point sampling for estimating species abundance and ecological diversity. Environ. Ecol. Statist., 5, 353-370. Barlow, R. E., Bartholomew, D. X, Brenner, J. M. and Brunk, H. D. (1972) Statistical Inference under Order Restrictions: the Theory and Application of Isotonic Regression. New York: Wiley. Clark, K. R. and Green, R. H. (1988) Statistical design and analysis for a 'biological effects' study. Mar. Ecol. Prog. Ser., 46, 213-226. Craven, R and Wahba, G. (1979) Smoothing noisy data with spline functions. Numer. Math., 31, 377^103. Di Battista, T. and Gattone, S. A. (2003) Non parametric tests and confidence regions for intrinsic diversity profiles of biological populations. Environmetrics, 14, 733-741. Di Battista, T. and Gattone, S. A. (2004) Multivariate bootstrap confidence regions for ecological populations using data depth. Environ. Ecol. Statist., 11, 355-365. Dole, D. (1999) CoSmo: a constrained scatterplot smoother for estimating convex, monotonic transformations. J. Bus. Econ. Statist, 17, 444-455. Efron, B. and Tibshirani, R. J. (1993) An Introduction to the Bootstrap. New York: Chapman and Hall. Elfving, T. and Anderson, L. E. (1988) An algorithm for computing constrained smoothing spline functions. Numer. Math., 52, 583-595. Faraway, J. J. (1997) Regression analysis for a functional response. Technometrics, 39, 254-261. Gove, J. H., Patil, G. R, Swindel, D. F. and Taillie, C. (1994) Ecological diversity and forest management. In Hand book of Statistics, vol. 12, Environmental Statistics (eds G R Patil and C. R. Rao), pp. 409-462. Amsterdam: Elsevier. Green, R J. and Silverman, B. W. (1994) Nonparametric Regression and Generalized Regression and Generalized Linear Models: a Roughness Penalty Approach. London: Chapman and Hall. Hart, P. E. (1971) Entropy and other measures of concentration. J. R. Statist. Soc. A, 134, 73-85. Hill, M. O. (1973) Diversity and evenness: a unifying notation and its consequences. Ecology, 54, 427-432. Kneip, A. and Gasser, T. (1992) Statistical tools to analyze data representing a sample of curves. Ann. Statist., 20, 1266-1305. Lek-Ang, S., Deharveng, L. and Lek, S. (1999) Predictive models of collembolan diversity and abundance in a riparian habitat. Ecol. Modllng, 120, 247-260. Liu, C, Whittaker, R. I, Ma, K. and Malcolm, J. R. (2007) Unifying and distinguishing diversity ordering methods for comparing communities. Popln Ecol, 49, 89-100. Mammen, E. (1991) Non parametric regression under qualitative smoothness assumptions. Ann. Statist., 19, 741-759. Manly, B. F. J. (1997) Randomization, Bootstrap and Monte Carlo Methods in Biology, 2nd edn. Boca Raton: Chapman and Hall-CRC. Marshall, A. W. and Olkin, I. (1974) Majorization in multivariate distributions. Ann. Statist, 2, 1189-1200. McCann, K. S. (2002) The diversity-stability debate. Nature, 405, 228-233.</page><page sequence="18">284 S. A. Gattone and T. Di Battista Moncreiff, R. and Perrin, S. (1979) The effect of increased water temperature on the diversity of periphyton. In Ecological Diversity in Theory and Practice (eds J. F. Grassle, G. P. Patil, W. Smith and C. Taillie), pp. 207-217. Fairland: International Co-operative Publishing House. Patil, G. P. and Taillie, C. (1982) Diversity as a concept and its measurement. J. Am. Statist. Ass., 11, 548-567. Pielou E. C. (1975) Ecological Diversity . New York: Wiley. Ramsay, J. O. (1988) Monotone regression splines in action (with discussion). Statist. Sci., 3, 425^61. Ramsay, J.O. (1998) Estimating smooth monotone functions. J. R. Statist. Soc. B, 60, 365-375. Ramsay, J. O. and Silverman, B. W. (2002) Applied Functional Data Analysis: Methods and Case Studies. New York: Springer. Ramsay, J. O. and Silverman, B. W. (2005) Functional Data Analysis, 2nd edn. New York: Springer. Renyi, A. (1961) On measures of entropy and information. In Proc. 4th Berkeley Symp. Mathematical Statistics and Probability, vol. 1, pp. 547-561. Berkeley: University of California Press. Rousseau, R., Van Hecke, P., Nijssen, D. and Bogaert, J. (1999) The relationship between diversity profiles, evenness and species richness based on partial ordering. Environ. Ecol. Statist., 6, 211-223. Shannon, C. (1948) A mathematical theory of communication. Bell Syst. Tech. J., 27, 379-423. Silverman, B. W. (1985) Some aspects of the spline smoothing approach to non-parametric regression curve fitting (with discussion). J. R. Statist. Soc. B, 47, 1-52. Smith, E. P. (1998) Randomization methods and the analysis of multivariate ecological data. Environmetries, 9, 37-51. Taylor, C. E. and Condra, C. (1979) Competitor diversity and chromosomal variation. In Ecological Diversity in Theory and Practice (eds J. F. Grassle, G. P. Patil, W. Smith and C. Taillie), pp. 297-308. Fairland: International Co-operative Publishing House. Tong, Y. L. (1983) Some distribution properties of the Sampling Species-Diversity indices and their applications. Biometrics, 39, 999-1008. Tothmeresz, B. (1995) Comparison of different methods for diversity ordering. J. Vegetn Sci, 6, 283-290. Wegman, J. E. and Wright, W I. (1983) Splines in Statistics. J. Am. Statist. Ass., 78, 351-365. Wright, I. and Wegman, E. (1980) Isotonic, convex and related splines. Ann. Statist., 8, 1023-1035.</page></plain_text>